<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø´Ø§Ø±Øª Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª Ù…Ø¹ Ø§Ù„Ø´Ù…ÙˆØ¹ ÙˆØ§Ù„ØªØ±Ù‚ÙŠÙ…</title>
    <style>
        body { background:#222; color:#fff; font-family:tahoma; text-align:center }
        canvas { background:#111; margin:20px auto; display:block; border-radius:12px; }
        .results { margin:24px auto; width:800px; text-align:left; background:#1a1a2e; border-radius:10px; padding:20px; }
        .wave-label { font-weight:bold; font-size:18px; }
        .error { color:#ff4757; margin-top:20px; }
    </style>
</head>
<body>
    <h2>Ø´Ø§Ø±Øª Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª Ù…Ø¹ Ø§Ù„Ø´Ù…ÙˆØ¹ ÙˆØ§Ù„ØªØ±Ù‚ÙŠÙ…</h2>
    <canvas id="elliottCandles" width="900" height="400"></canvas>
    <div id="analysisResult" class="results"></div>
    <script src="elliott-wave.js"></script>
    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠØ© (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Binance)
        const klineData = [
            [1, "100", "105", "99", "104", "1500"],
            [2, "104", "108", "103", "107", "1700"],
            [3, "107", "109", "105", "106", "1600"],
            [4, "106", "110", "104", "110", "1800"],
            [5, "110", "115", "109", "114", "2000"],
            [6, "114", "116", "111", "112", "1900"],
            [7, "112", "113", "110", "111", "1200"],
            [8, "111", "115", "109", "114", "1400"],
            [9, "114", "117", "112", "116", "1700"],
            [10, "116", "119", "115", "118", "1800"],
            [11, "118", "120", "117", "119", "1600"],
            [12, "119", "122", "118", "121", "1850"],
            [13, "121", "123", "120", "122", "1750"],
            [14, "122", "124", "121", "123", "1600"],
            [15, "123", "126", "122", "125", "1900"],
            [16, "125", "128", "124", "127", "2000"],
            [17, "127", "130", "126", "129", "2100"],
            [18, "129", "132", "128", "131", "2200"],
            [19, "131", "134", "130", "133", "2300"],
            [20, "133", "136", "132", "135", "2400"]
        ];

        // Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù„Ù„ Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª
        const analyzer = new ElliottWaveAnalyzer();
        const analysis = analyzer.analyze(klineData);

        // Ø±Ø³Ù… Ø§Ù„Ø´Ù…ÙˆØ¹ Ù…Ø¹ ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ù…ÙˆØ¬Ø§Øª
        function drawCandles(kline, analysis) {
            const canvas = document.getElementById('elliottCandles');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height, pad = 60;
            const candleWidth = Math.floor((w - 2*pad) / kline.length * 0.8);

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ø¹Ø§Ø± Ø¹Ø§Ù„ÙŠØ© ÙˆÙ…Ù†Ø®ÙØ¶Ø©
            const highs = kline.map(k => parseFloat(k[2]));
            const lows = kline.map(k => parseFloat(k[3]));
            const minP = Math.min(...lows), maxP = Math.max(...highs);
            const xStep = (w - 2*pad) / kline.length;

            // Ø±Ø³Ù… Ø§Ù„Ù…Ø­ÙˆØ±
            ctx.clearRect(0,0,w,h);
            ctx.strokeStyle = "#444";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(pad, h - pad);
            ctx.lineTo(w - pad, h - pad);
            ctx.moveTo(pad, pad);
            ctx.lineTo(pad, h - pad);
            ctx.stroke();

            // Ø±Ø³Ù… Ø§Ù„Ø´Ù…ÙˆØ¹
            for (let i = 0; i < kline.length; i++) {
                const [_, open, high, low, close] = kline[i].map(Number);
                const x = pad + i * xStep + xStep / 2;
                const yHigh = pad + (h - 2*pad) * (1 - (high - minP)/(maxP-minP));
                const yLow = pad + (h - 2*pad) * (1 - (low - minP)/(maxP-minP));
                const yOpen = pad + (h - 2*pad) * (1 - (open - minP)/(maxP-minP));
                const yClose = pad + (h - 2*pad) * (1 - (close - minP)/(maxP-minP));

                // Ù„ÙˆÙ† Ø§Ù„Ø´Ù…Ø¹Ø©
                const up = close >= open;
                ctx.strokeStyle = up ? "#00ff88" : "#ff4757";
                ctx.lineWidth = 2;

                // ÙØªÙŠÙ„Ø© Ø§Ù„Ø´Ù…Ø¹Ø©
                ctx.beginPath();
                ctx.moveTo(x, yHigh);
                ctx.lineTo(x, yLow);
                ctx.stroke();

                // Ø¬Ø³Ù… Ø§Ù„Ø´Ù…Ø¹Ø©
                ctx.beginPath();
                ctx.rect(x - candleWidth/2, Math.min(yOpen, yClose), candleWidth, Math.abs(yOpen - yClose));
                ctx.fillStyle = up ? "#00ff88" : "#ff4757";
                ctx.globalAlpha = 0.7;
                ctx.fill();
                ctx.globalAlpha = 1.0;
                ctx.stroke();

            }

            // Ø±Ø³Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙˆØ¬Ø© ÙˆØªØ±Ù‚ÙŠÙ…Ù‡Ø§
            if (analysis.patterns && analysis.patterns.length > 0) {
                const pattern = analysis.patterns[0];
                pattern.points.forEach((pt, idx) => {
                    const x = pad + pt.index * xStep + xStep / 2;
                    const y = pad + (h - 2*pad) * (1 - (pt.price - minP)/(maxP-minP));

                    ctx.beginPath();
                    ctx.arc(x, y, 12, 0, 2*Math.PI);
                    ctx.fillStyle = pattern.type === 'motive' ? "#ffba08" : "#ffa502";
                    ctx.fill();

                    ctx.font = "bold 18px Arial";
                    ctx.fillStyle = "#222";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    const label = pattern.type === "motive" ? (idx+1) : String.fromCharCode(65+idx);
                    ctx.fillText(label, x, y);

                    // Ø±Ø³Ù… Ø®Ø· Ø¨ÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø·
                    if (idx > 0) {
                        const prevPt = pattern.points[idx-1];
                        const px = pad + prevPt.index * xStep + xStep / 2;
                        const py = pad + (h - 2*pad) * (1 - (prevPt.price - minP)/(maxP-minP));
                        ctx.strokeStyle = "#fff";
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(px, py);
                        ctx.lineTo(x, y);
                        ctx.stroke();
                    }
                });
            }
        }

        drawCandles(klineData, analysis);

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†ØµÙŠØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„
        function showAnalysis(analysis) {
            const div = document.getElementById("analysisResult");
            if (!analysis || !analysis.patterns || analysis.patterns.length === 0)
                return div.innerHTML = '<div class="error">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ù…Ø· Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª ØµØ§Ù„Ø­ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>';

            const pattern = analysis.patterns[0];
            let html = `
                <h3>Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„:</h3>
                <p><span class="wave-label">Ø§Ù„Ù†Ù…Ø·:</span> ${pattern.type === 'motive' ? 'Ø¯Ø§ÙØ¹ (1-2-3-4-5)' : 'ØªØµØ­ÙŠØ­ÙŠ (A-B-C)'}</p>
                <p><span class="wave-label">Ø§Ù„Ø§ØªØ¬Ø§Ù‡:</span> ${pattern.direction === 'bullish' ? 'ØµØ§Ø¹Ø¯ ğŸš€' : 'Ù‡Ø§Ø¨Ø· ğŸ“‰'}</p>
                <p><span class="wave-label">Ø§Ù„Ø«Ù‚Ø©:</span> ${pattern.confidence}%</p>
                <p><span class="wave-label">Ù…ÙˆØ¬Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„:</span> ${pattern.points.map((pt, idx) => pattern.type === 'motive' ? (idx+1) : String.fromCharCode(65+idx)).join(' - ')}</p>
                <p><span class="wave-label">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</span> $${pattern.targets.finalTarget.toFixed(2)}</p>
                <p><span class="wave-label">Ø§Ù„Ø¯Ø¹Ù…:</span> $${pattern.targets.support.toFixed(2)} | <span class="wave-label">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©:</span> $${pattern.targets.resistance.toFixed(2)}</p>
                <hr>
                <p><span class="wave-label">Ø§Ù„ØªÙˆØµÙŠØ©:</span> ${
                    analysis.recommendations && analysis.recommendations.length > 0 ?
                    analysis.recommendations[0].message : 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ© ÙˆØ§Ø¶Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹'
                }</p>
                <p><span class="wave-label">Ø§Ù„Ù…Ù„Ø®Øµ:</span> ${analysis.summary}</p>
            `;
            div.innerHTML = html;
        }
        showAnalysis(analysis);
    </script>
</body>
</html>
