<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø´Ø§Ø±Øª Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª Ù…Ø¹ Plotly Candlestick</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { background: #222; color: #fff; font-family: Tahoma; text-align: center }
        #plotly_chart { margin: 40px auto; width: 900px; height: 500px; }
        .results { margin: 24px auto; width: 900px; background:#1a1a2e; border-radius:10px; padding:20px; text-align: left; }
        .wave-label { font-weight: bold; font-size: 18px; }
        .error { color: #ff4757; margin-top: 20px; }
    </style>
</head>
<body>
    <h2>Ø´Ø§Ø±Øª Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª Ù…Ø¹ Plotly Candlestick</h2>
    <div id="plotly_chart"></div>
    <div id="analysisResult" class="results"></div>
    <script src="elliott-wave.js"></script>
    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø£Ùˆ Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        const klineData = [
            [1690000000000, "100", "105", "99", "104", "1500"],
            [1690003600000, "104", "108", "103", "107", "1700"],
            [1690007200000, "107", "109", "105", "106", "1600"],
            [1690010800000, "106", "110", "104", "110", "1800"],
            [1690014400000, "110", "115", "109", "114", "2000"],
            [1690018000000, "114", "116", "111", "112", "1900"],
            [1690021600000, "112", "113", "110", "111", "1200"],
            [1690025200000, "111", "115", "109", "114", "1400"],
            [1690028800000, "114", "117", "112", "116", "1700"],
            [1690032400000, "116", "119", "115", "118", "1800"],
            [1690036000000, "118", "120", "117", "119", "1600"],
            [1690039600000, "119", "122", "118", "121", "1850"],
            [1690043200000, "121", "123", "120", "122", "1750"],
            [1690046800000, "122", "124", "121", "123", "1600"],
            [1690050400000, "123", "126", "122", "125", "1900"],
            [1690054000000, "125", "128", "124", "127", "2000"],
            [1690057600000, "127", "130", "126", "129", "2100"],
            [1690061200000, "129", "132", "128", "131", "2200"],
            [1690064800000, "131", "134", "130", "133", "2300"],
            [1690068400000, "133", "136", "132", "135", "2400"]
        ]; // Ø§Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù‡Ù†Ø§!

        // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ù„Ù„
        const analyzer = new ElliottWaveAnalyzer();
        const analysis = analyzer.analyze(klineData);

        // ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù…ÙˆØ¹ Ù„Ù€ Plotly
        const times  = klineData.map(k => new Date(Number(k[0])));
        const open   = klineData.map(k => Number(k[1]));
        const high   = klineData.map(k => Number(k[2]));
        const low    = klineData.map(k => Number(k[3]));
        const close  = klineData.map(k => Number(k[4]));

        // ØªØ­Ø¶ÙŠØ± Ù†Ù‚Ø§Ø· Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª Ù„Ù„ØªØ±Ù‚ÙŠÙ…
        let annotations = [];
        if (analysis.patterns && analysis.patterns.length > 0) {
            const pattern = analysis.patterns[0];
            pattern.points.forEach((pt, idx) => {
                const x = times[pt.index];
                const y = pt.price;
                const label = pattern.type === "motive" ? (idx + 1) : String.fromCharCode(65 + idx); // 1,2,3... Ø£Ùˆ A,B,C...
                annotations.push({
                    x: x,
                    y: y,
                    text: label,
                    xref: 'x',
                    yref: 'y',
                    showarrow: true,
                    arrowhead: 2,
                    ax: 0,
                    ay: -30,
                    font: {
                        color: pattern.type === "motive" ? "#ff4757" : "#ffa502",
                        size: 18,
                        family: "Tahoma"
                    },
                    bgcolor: "#fff",
                    bordercolor: "#222"
                });
            });
        }

        // Ø±Ø³Ù… Ø§Ù„Ø´Ø§Ø±Øª Ø¨Ø§Ù„Ø´Ù…ÙˆØ¹ ÙˆØªØ±Ù‚ÙŠÙ… Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª
        Plotly.newPlot('plotly_chart', [{
            x: times,
            open: open,
            high: high,
            low: low,
            close: close,
            type: 'candlestick',
            name: 'Ø§Ù„Ø´Ù…ÙˆØ¹'
        }], {
            margin: { t: 30, r: 30, l: 50, b: 50 },
            plot_bgcolor: "#111",
            paper_bgcolor: "#222",
            annotations: annotations,
            xaxis: {
                title: "Ø§Ù„Ø²Ù…Ù†",
                color: "#fff",
                rangeslider: { visible: false },
                showgrid: false
            },
            yaxis: {
                title: "Ø§Ù„Ø³Ø¹Ø±",
                color: "#fff",
                showgrid: true
            }
        });

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†ØµÙŠØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„
        function showAnalysis(analysis) {
            const div = document.getElementById("analysisResult");
            if (!analysis || !analysis.patterns || analysis.patterns.length === 0) {
                return div.innerHTML = '<div class="error">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ù…Ø· Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª ØµØ§Ù„Ø­ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>';
            }
            const pattern = analysis.patterns[0];
            let html = `
                <h3>Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„:</h3>
                <p><span class="wave-label">Ø§Ù„Ù†Ù…Ø·:</span> ${pattern.type === 'motive' ? 'Ø¯Ø§ÙØ¹ (1-2-3-4-5)' : 'ØªØµØ­ÙŠØ­ÙŠ (A-B-C)'}</p>
                <p><span class="wave-label">Ø§Ù„Ø§ØªØ¬Ø§Ù‡:</span> ${pattern.direction === 'bullish' ? 'ØµØ§Ø¹Ø¯ ğŸš€' : 'Ù‡Ø§Ø¨Ø· ğŸ“‰'}</p>
                <p><span class="wave-label">Ø§Ù„Ø«Ù‚Ø©:</span> ${pattern.confidence}%</p>
                <p><span class="wave-label">Ù…ÙˆØ¬Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„:</span> ${pattern.points.map((pt, idx) => pattern.type === 'motive' ? (idx + 1) : String.fromCharCode(65 + idx)).join(' - ')}</p>
                <p><span class="wave-label">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</span> $${pattern.targets.finalTarget.toFixed(2)}</p>
                <p><span class="wave-label">Ø§Ù„Ø¯Ø¹Ù…:</span> $${pattern.targets.support.toFixed(2)} | <span class="wave-label">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©:</span> $${pattern.targets.resistance.toFixed(2)}</p>
                <hr>
                <p><span class="wave-label">Ø§Ù„ØªÙˆØµÙŠØ©:</span> ${
                    analysis.recommendations && analysis.recommendations.length > 0 ?
                    analysis.recommendations[0].message : 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ© ÙˆØ§Ø¶Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹'
                }</p>
                <p><span class="wave-label">Ø§Ù„Ù…Ù„Ø®Øµ:</span> ${analysis.summary}</p>
            `;
            div.innerHTML = html;
        }
        showAnalysis(analysis);
    </script>
</body>
</html>
