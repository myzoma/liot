<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุญูู ููุฌุงุช ุฅูููุช ุงููุชูุฏู</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .wave-impulse { color: #28a745; font-weight: bold; }
        .wave-corrective { color: #dc3545; font-weight: bold; }
        .fibonacci-level { background: linear-gradient(90deg, #ffd700, #ffed4e); }
        .pattern-detected { border-left: 4px solid #007bff; }
        .high-confidence { background-color: #d4edda; }
        .medium-confidence { background-color: #fff3cd; }
        .low-confidence { background-color: #f8d7da; }
    </style>
</head>
<body>
    <div class="container-fluid mt-3">
        <h1 class="text-center mb-4">๐ ูุญูู ููุฌุงุช ุฅูููุช ุงููุชูุฏู</h1>
        
        <!-- ููุญุฉ ุงูุชุญูู -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row align-items-end">
                            <div class="col-md-2">
                                <label class="form-label">ุฑูุฒ ุงูุนููุฉ</label>
                                <input type="text" id="symbolInput" class="form-control" placeholder="BTCUSDT" value="BTCUSDT">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">ุงููุชุฑุฉ ุงูุฒูููุฉ</label>
                                <select id="intervalSelect" class="form-select">
                                    <option value="15m">15 ุฏูููุฉ</option>
                                    <option value="1h">ุณุงุนุฉ ูุงุญุฏุฉ</option>
                                    <option value="4h" selected>4 ุณุงุนุงุช</option>
                                    <option value="1d">ููู ูุงุญุฏ</option>
                                    <option value="1w">ุฃุณุจูุน ูุงุญุฏ</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">ุนุฏุฏ ุงูุดููุน</label>
                                <select id="limitSelect" class="form-select">
                                    <option value="200">200</option>
                                    <option value="500" selected>500</option>
                                    <option value="1000">1000</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">ููุน ุงูุชุญููู</label>
                                <select id="analysisType" class="form-select">
                                    <option value="full" selected>ุชุญููู ุดุงูู</option>
                                    <option value="impulse">ููุฌุงุช ุฏุงูุนุฉ ููุท</option>
                                    <option value="corrective">ููุฌุงุช ุชุตุญูุญูุฉ ููุท</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button id="analyzeBtn" class="btn btn-primary w-100">ุชุญููู ูุชูุฏู</button>
                            </div>
                            <div class="col-md-2">
                                <button id="scanBtn" class="btn btn-success w-100">ูุณุญ ุงูุณูู</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ุดุฑูุท ุงูุชุญููู -->
        <div id="loadingBar" style="display: none;">
            <div class="progress mb-3">
                <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%">
                    <span id="loadingText">ุฌุงุฑู ุงูุชุญููู ุงููุชูุฏู...</span>
                </div>
            </div>
        </div>

        <!-- ุงููุชุงุฆุฌ -->
        <div class="row">
            <!-- ุงูุฑุณู ุงูุจูุงูู -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 id="chartTitle">ุงูุฑุณู ุงูุจูุงูู ูุน ุชุฑููู ุงูููุฌุงุช</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="priceChart" width="800" height="400"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ุชูุงุตูู ุงูุชุญููู -->
            <div class="col-md-4">
                <div id="analysisDetails"></div>
            </div>
        </div>

        <!-- ุชูุงุตูู ุงูููุฌุงุช -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ุชูุงุตูู ุงูููุฌุงุช ุงูููุชุดูุฉ</h5>
                    </div>
                    <div class="card-body">
                        <div id="waveDetails"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ูุณุชููุงุช ููุจููุงุชุดู -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ูุณุชููุงุช ููุจููุงุชุดู</h5>
                    </div>
                    <div class="card-body">
                        <div id="fibonacciLevels"></div>
                    </div>
                </div>
            </div>
            
            <!-- ุงูุฃููุงุท ุงูููุชุดูุฉ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ุงูุฃููุงุท ุงูููุชุดูุฉ</h5>
                    </div>
                    <div class="card-body">
                        <div id="detectedPatterns"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ุงูุชูุตูุงุช ุงููุชูุฏูุฉ -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ุงูุชูุตูุงุช ูุงูุชููุนุงุช</h5>
                    </div>
                    <div class="card-body">
                        <div id="advancedRecommendations"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ูุญูู ููุฌุงุช ุฅูููุช ุงููุชูุฏู
        class AdvancedElliottWaveAnalyzer {
            constructor() {
                this.fibonacciRatios = [0.236, 0.382, 0.5, 0.618, 0.786, 1.0, 1.272, 1.618, 2.618];
                this.wavePatterns = {
                    impulse: ['1', '2', '3', '4', '5'],
                    corrective: ['A', 'B', 'C'],
                    complex: ['W', 'X', 'Y', 'Z']
                };
            }

            // ุชุญููู ุดุงูู ููุจูุงูุงุช
            analyzeData(data) {
                if (!data || data.length < 100) {
                    throw new Error('ุจูุงูุงุช ุบูุฑ ูุงููุฉ ููุชุญููู ุงููุชูุฏู');
                }

                const analysis = {
                    waves: this.identifyWaves(data),
                    patterns: this.detectPatterns(data),
                    fibonacci: this.calculateFibonacci(data),
                    trend: this.analyzeTrend(data),
                    support_resistance: this.findSupportResistance(data),
                    predictions: this.generatePredictions(data),
                    confidence: 0
                };

                analysis.confidence = this.calculateConfidence(analysis);
                return analysis;
            }

            // ุชุญุฏูุฏ ุงูููุฌุงุช
            identifyWaves(data) {
                const waves = [];
                const pivots = this.findPivotPoints(data);
                
                if (pivots.length < 5) return waves;

                // ุชุญุฏูุฏ ุงูููุฌุงุช ุงูุฏุงูุนุฉ (1-2-3-4-5)
                const impulseWaves = this.findImpulseWaves(pivots, data);
                waves.push(...impulseWaves);

                // ุชุญุฏูุฏ ุงูููุฌุงุช ุงูุชุตุญูุญูุฉ (A-B-C)
                const correctiveWaves = this.findCorrectiveWaves(pivots, data);
                waves.push(...correctiveWaves);

                return waves.sort((a, b) => a.startIndex - b.startIndex);
            }

            // ุงูุนุซูุฑ ุนูู ููุงุท ุงููุญูุฑุฉ
            findPivotPoints(data, window = 10) {
                const pivots = [];
                
                for (let i = window; i < data.length - window; i++) {
                    const current = data[i];
                    let isHigh = true;
                    let isLow = true;

                    // ูุญุต ุงูููุงุท ุงููุญูุทุฉ
                    for (let j = i - window; j <= i + window; j++) {
                        if (j === i) continue;
                        
                        if (data[j].high >= current.high) isHigh = false;
                        if (data[j].low <= current.low) isLow = false;
                    }

                    if (isHigh) {
                        pivots.push({
                            index: i,
                            type: 'high',
                            price: current.high,
                            timestamp: current.timestamp
                        });
                    }

                    if (isLow) {
                        pivots.push({
                            index: i,
                            type: 'low',
                            price: current.low,
                            timestamp: current.timestamp
                        });
                    }
                }

                return pivots.sort((a, b) => a.index - b.index);
            }

            // ุงูุนุซูุฑ ุนูู ุงูููุฌุงุช ุงูุฏุงูุนุฉ
            findImpulseWaves(pivots, data) {
                const impulseWaves = [];
                
                for (let i = 0; i < pivots.length - 4; i++) {
                    const sequence = pivots.slice(i, i + 5);
                    
                    if (this.isValidImpulseSequence(sequence)) {
                        const waves = this.createImpulseWaves(sequence, data);
                        impulseWaves.push(...waves);
                    }
                }

                return impulseWaves;
            }

            // ุงูุชุญูู ูู ุตุญุฉ ุชุณูุณู ุงูููุฌุงุช ุงูุฏุงูุนุฉ
            isValidImpulseSequence(sequence) {
                if (sequence.length !== 5) return false;

                // ููุงุนุฏ ููุฌุงุช ุฅูููุช ููููุฌุงุช ุงูุฏุงูุนุฉ
                const rules = [
                    // ุงูููุฌุฉ 2 ูุง ุชุชุฌุงูุฒ ุจุฏุงูุฉ ุงูููุฌุฉ 1
                    sequence[1].type !== sequence[0].type,
                    // ุงูููุฌุฉ 3 ููุณุช ุงูุฃูุตุฑ
                    true, // ุณูุชู ูุญุตูุง ูุงุญูุงู
                    // ุงูููุฌุฉ 4 ูุง ุชุชุฏุงุฎู ูุน ุงูููุฌุฉ 1
                    true, // ุณูุชู ูุญุตูุง ูุงุญูุงู
                    // ุงูููุฌุฉ 5 ุชุชุญุฑู ูู ููุณ ุงุชุฌุงู ุงูููุฌุงุช 1 ู 3
                    true
                ];

                return rules.every(rule => rule);
            }

            // ุฅูุดุงุก ุงูููุฌุงุช ุงูุฏุงูุนุฉ
            createImpulseWaves(sequence, data) {
                const waves = [];
                const waveLabels = ['1', '2', '3', '4', '5'];

                for (let i = 0; i < sequence.length - 1; i++) {
                    const start = sequence[i];
                    const end = sequence[i + 1];
                    
                    waves.push({
                        label: waveLabels[i],
                        type: 'impulse',
                        startIndex: start.index,
                        endIndex: end.index,
                        startPrice: start.price,
                        endPrice: end.price,
                        direction: end.price > start.price ? 'up' : 'down',
                        length: Math.abs(end.price - start.price),
                        duration: end.index - start.index,
                        confidence: this.calculateWaveConfidence(start, end, data)
                    });
                }

                return waves;
            }

            // ุงูุนุซูุฑ ุนูู ุงูููุฌุงุช ุงูุชุตุญูุญูุฉ
            findCorrectiveWaves(pivots, data) {
                const correctiveWaves = [];
                
                for (let i = 0; i < pivots.length - 2; i++) {
                    const sequence = pivots.slice(i, i + 3);
                    
                    if (this.isValidCorrectiveSequence(sequence)) {
                        const waves = this.createCorrectiveWaves(sequence, data);
                        correctiveWaves.push(...waves);
                    }
                }

                return correctiveWaves;
            }

            // ุงูุชุญูู ูู ุตุญุฉ ุชุณูุณู ุงูููุฌุงุช ุงูุชุตุญูุญูุฉ
            isValidCorrectiveSequence(sequence) {
                if (sequence.length !== 3) return false;
                
                // ุงูููุฌุฉ B ูุฌุจ ุฃู ุชููู ูู ุงูุงุชุฌุงู ุงููุนุงูุณ ููููุฌุฉ A
                return sequence[0].type !== sequence[1].type && 
                       sequence[1].type !== sequence[2].type;
            }

            // ุฅูุดุงุก ุงูููุฌุงุช ุงูุชุตุญูุญูุฉ
            createCorrectiveWaves(sequence, data) {
                const waves = [];
                const waveLabels = ['A', 'B', 'C'];

                for (let i = 0; i < sequence.length - 1; i++) {
                    const start = sequence[i];
                    const end = sequence[i + 1];
                    
                    waves.push({
                        label: waveLabels[i],
                        type: 'corrective',
                        startIndex: start.index,
                        endIndex: end.index,
                        startPrice: start.price,
                        endPrice: end.price,
                        direction: end.price > start.price ? 'up' : 'down',
                                           length: Math.abs(end.price - start.price),
                        duration: end.index - start.index,
                        confidence: this.calculateWaveConfidence(start, end, data)
                    });
                }

                return waves;
            }

            // ุญุณุงุจ ุซูุฉ ุงูููุฌุฉ
            calculateWaveConfidence(start, end, data) {
                let confidence = 50;
                
                // ุฒูุงุฏุฉ ุงูุซูุฉ ุจูุงุกู ุนูู ุทูู ุงูููุฌุฉ
                const waveLength = Math.abs(end.price - start.price);
                const avgPrice = (start.price + end.price) / 2;
                const lengthRatio = (waveLength / avgPrice) * 100;
                
                if (lengthRatio > 5) confidence += 20;
                else if (lengthRatio > 2) confidence += 10;
                
                // ุฒูุงุฏุฉ ุงูุซูุฉ ุจูุงุกู ุนูู ุงูุญุฌู
                const volumeData = data.slice(start.index, end.index + 1);
                const avgVolume = volumeData.reduce((sum, d) => sum + d.volume, 0) / volumeData.length;
                const recentAvgVolume = data.slice(-20).reduce((sum, d) => sum + d.volume, 0) / 20;
                
                if (avgVolume > recentAvgVolume * 1.5) confidence += 15;
                else if (avgVolume > recentAvgVolume) confidence += 5;
                
                return Math.min(confidence, 95);
            }

            // ูุดู ุงูุฃููุงุท
            detectPatterns(data) {
                const patterns = [];
                
                // ููุท ุงูุฑุฃุณ ูุงููุชููู
                const headShoulders = this.detectHeadAndShoulders(data);
                if (headShoulders) patterns.push(headShoulders);
                
                // ููุท ุงููุซูุซ
                const triangle = this.detectTriangle(data);
                if (triangle) patterns.push(triangle);
                
                // ููุท ุงูููุงุฉ
                const channel = this.detectChannel(data);
                if (channel) patterns.push(channel);
                
                // ููุท ุงููุชุฏ
                const wedge = this.detectWedge(data);
                if (wedge) patterns.push(wedge);
                
                return patterns;
            }

            // ูุดู ููุท ุงูุฑุฃุณ ูุงููุชููู
            detectHeadAndShoulders(data) {
                const pivots = this.findPivotPoints(data, 5);
                const highs = pivots.filter(p => p.type === 'high').slice(-5);
                
                if (highs.length < 3) return null;
                
                const [left, head, right] = highs.slice(-3);
                
                if (head.price > left.price && head.price > right.price &&
                    Math.abs(left.price - right.price) / left.price < 0.05) {
                    
                    return {
                        type: 'Head and Shoulders',
                        confidence: 75,
                        direction: 'bearish',
                        neckline: (left.price + right.price) / 2,
                        target: (left.price + right.price) / 2 - (head.price - (left.price + right.price) / 2),
                        description: 'ููุท ุงูุฑุฃุณ ูุงููุชููู - ุฅุดุงุฑุฉ ูุจูุทูุฉ'
                    };
                }
                
                return null;
            }

            // ูุดู ููุท ุงููุซูุซ
            detectTriangle(data) {
                const recentData = data.slice(-50);
                const highs = [];
                const lows = [];
                
                for (let i = 5; i < recentData.length - 5; i++) {
                    let isHigh = true;
                    let isLow = true;
                    
                    for (let j = i - 5; j <= i + 5; j++) {
                        if (j === i) continue;
                        if (recentData[j].high >= recentData[i].high) isHigh = false;
                        if (recentData[j].low <= recentData[i].low) isLow = false;
                    }
                    
                    if (isHigh) highs.push({ index: i, price: recentData[i].high });
                    if (isLow) lows.push({ index: i, price: recentData[i].low });
                }
                
                if (highs.length >= 2 && lows.length >= 2) {
                    const highTrend = this.calculateTrendLine(highs);
                    const lowTrend = this.calculateTrendLine(lows);
                    
                    if (Math.abs(highTrend.slope) > 0.001 || Math.abs(lowTrend.slope) > 0.001) {
                        return {
                            type: 'Triangle',
                            confidence: 65,
                            direction: highTrend.slope < 0 && lowTrend.slope > 0 ? 'converging' : 'diverging',
                            description: 'ููุท ุงููุซูุซ - ุชููุน ูุณุฑ ูุฑูุจ'
                        };
                    }
                }
                
                return null;
            }

            // ูุดู ููุท ุงูููุงุฉ
            detectChannel(data) {
                const recentData = data.slice(-100);
                const pivots = this.findPivotPoints(recentData, 3);
                const highs = pivots.filter(p => p.type === 'high');
                const lows = pivots.filter(p => p.type === 'low');
                
                if (highs.length >= 3 && lows.length >= 3) {
                    const highTrend = this.calculateTrendLine(highs);
                    const lowTrend = this.calculateTrendLine(lows);
                    
                    // ูุญุต ุฅุฐุง ูุงูุช ุงูุฎุทูุท ูุชูุงุฒูุฉ
                    if (Math.abs(highTrend.slope - lowTrend.slope) < 0.001) {
                        return {
                            type: 'Channel',
                            confidence: 70,
                            direction: highTrend.slope > 0 ? 'ascending' : 'descending',
                            upperLine: highTrend,
                            lowerLine: lowTrend,
                            description: highTrend.slope > 0 ? 'ููุงุฉ ุตุงุนุฏุฉ' : 'ููุงุฉ ูุงุจุทุฉ'
                        };
                    }
                }
                
                return null;
            }

            // ูุดู ููุท ุงููุชุฏ
            detectWedge(data) {
                const recentData = data.slice(-80);
                const pivots = this.findPivotPoints(recentData, 3);
                const highs = pivots.filter(p => p.type === 'high');
                const lows = pivots.filter(p => p.type === 'low');
                
                if (highs.length >= 3 && lows.length >= 3) {
                    const highTrend = this.calculateTrendLine(highs);
                    const lowTrend = this.calculateTrendLine(lows);
                    
                    // ุงููุชุฏ ุงูุตุงุนุฏ: ุฎุท ุงูููุงููุฉ ุฃูู ุงูุญุฏุงุฑุงู ูู ุฎุท ุงูุฏุนู
                    if (highTrend.slope > 0 && lowTrend.slope > 0 && lowTrend.slope > highTrend.slope) {
                        return {
                            type: 'Rising Wedge',
                            confidence: 68,
                            direction: 'bearish',
                            description: 'ูุชุฏ ุตุงุนุฏ - ุฅุดุงุฑุฉ ูุจูุทูุฉ ูุญุชููุฉ'
                        };
                    }
                    
                    // ุงููุชุฏ ุงููุงุจุท
                    if (highTrend.slope < 0 && lowTrend.slope < 0 && highTrend.slope > lowTrend.slope) {
                        return {
                            type: 'Falling Wedge',
                            confidence: 68,
                            direction: 'bullish',
                            description: 'ูุชุฏ ูุงุจุท - ุฅุดุงุฑุฉ ุตุงุนุฏุฉ ูุญุชููุฉ'
                        };
                    }
                }
                
                return null;
            }

            // ุญุณุงุจ ุฎุท ุงูุงุชุฌุงู
            calculateTrendLine(points) {
                if (points.length < 2) return null;
                
                const n = points.length;
                const sumX = points.reduce((sum, p) => sum + p.index, 0);
                const sumY = points.reduce((sum, p) => sum + p.price, 0);
                const sumXY = points.reduce((sum, p) => sum + (p.index * p.price), 0);
                const sumXX = points.reduce((sum, p) => sum + (p.index * p.index), 0);
                
                const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                
                return { slope, intercept };
            }

            // ุญุณุงุจ ูุณุชููุงุช ููุจููุงุชุดู
            calculateFibonacci(data) {
                const recentData = data.slice(-100);
                const high = Math.max(...recentData.map(d => d.high));
                const low = Math.min(...recentData.map(d => d.low));
                const range = high - low;
                
                const levels = this.fibonacciRatios.map(ratio => ({
                    ratio: ratio,
                    price: high - (range * ratio),
                    level: `${(ratio * 100).toFixed(1)}%`,
                    type: this.getFibonacciLevelType(ratio)
                }));
                
                return {
                    high,
                    low,
                    range,
                    levels: levels.sort((a, b) => b.price - a.price)
                };
            }

            // ุชุญุฏูุฏ ููุน ูุณุชูู ููุจููุงุชุดู
            getFibonacciLevelType(ratio) {
                if (ratio === 0.382 || ratio === 0.618) return 'strong';
                if (ratio === 0.5 || ratio === 1.0) return 'medium';
                return 'weak';
            }

            // ุชุญููู ุงูุงุชุฌุงู
            analyzeTrend(data) {
                const shortTerm = this.calculateMovingAverage(data.slice(-20));
                const mediumTerm = this.calculateMovingAverage(data.slice(-50));
                const longTerm = this.calculateMovingAverage(data.slice(-100));
                const currentPrice = data[data.length - 1].close;
                
                let trend = 'sideways';
                let strength = 0;
                
                if (currentPrice > shortTerm && shortTerm > mediumTerm && mediumTerm > longTerm) {
                    trend = 'strong_bullish';
                    strength = 85;
                } else if (currentPrice > shortTerm && shortTerm > mediumTerm) {
                    trend = 'bullish';
                    strength = 65;
                } else if (currentPrice < shortTerm && shortTerm < mediumTerm && mediumTerm < longTerm) {
                    trend = 'strong_bearish';
                    strength = 85;
                } else if (currentPrice < shortTerm && shortTerm < mediumTerm) {
                    trend = 'bearish';
                    strength = 65;
                } else {
                    strength = 30;
                }
                
                return {
                    direction: trend,
                    strength,
                    shortMA: shortTerm,
                    mediumMA: mediumTerm,
                    longMA: longTerm,
                    currentPrice
                };
            }

            // ุญุณุงุจ ุงููุชูุณุท ุงููุชุญุฑู
            calculateMovingAverage(data) {
                return data.reduce((sum, d) => sum + d.close, 0) / data.length;
            }

            // ุงูุนุซูุฑ ุนูู ูุณุชููุงุช ุงูุฏุนู ูุงูููุงููุฉ
            findSupportResistance(data) {
                const pivots = this.findPivotPoints(data, 5);
                const resistanceLevels = pivots.filter(p => p.type === 'high')
                    .map(p => p.price)
                    .sort((a, b) => b - a)
                    .slice(0, 5);
                
                const supportLevels = pivots.filter(p => p.type === 'low')
                    .map(p => p.price)
                    .sort((a, b) => a - b)
                    .slice(0, 5);
                
                return {
                    resistance: resistanceLevels,
                    support: supportLevels,
                    nearest: {
                        resistance: resistanceLevels.find(r => r > data[data.length - 1].close),
                        support: supportLevels.reverse().find(s => s < data[data.length - 1].close)
                    }
                };
            }

            // ุชูููุฏ ุงูุชููุนุงุช
            generatePredictions(data) {
                const currentPrice = data[data.length - 1].close;
                const trend = this.analyzeTrend(data);
                const fibonacci = this.calculateFibonacci(data);
                
                const predictions = [];
                
                // ุชููุนุงุช ูุตูุฑุฉ ุงููุฏู
                if (trend.direction.includes('bullish')) {
                    predictions.push({
                        timeframe: 'short',
                        direction: 'up',
                        target: currentPrice * 1.05,
                        probability: trend.strength,
                        reasoning: 'ุงูุงุชุฌุงู ุงูุตุงุนุฏ ููู'
                    });
                } else if (trend.direction.includes('bearish')) {
                    predictions.push({
                        timeframe: 'short',
                        direction: 'down',
                        target: currentPrice * 0.95,
                        probability: trend.strength,
                        reasoning: 'ุงูุงุชุฌุงู ุงููุงุจุท ููู'
                    });
                }
                
                // ุชููุนุงุช ูุชูุณุทุฉ ุงููุฏู ุจูุงุกู ุนูู ููุจููุงุชุดู
                const nextFibLevel = fibonacci.levels.find(l => 
                    Math.abs(l.price - currentPrice) > currentPrice * 0.02
                );
                
                if (nextFibLevel) {
                    predictions.push({
                        timeframe: 'medium',
                        direction: nextFibLevel.price > currentPrice ? 'up' : 'down',
                        target: nextFibLevel.price,
                        probability: nextFibLevel.type === 'strong' ? 70 : 50,
                        reasoning: `ูุณุชูู ููุจููุงุชุดู ${nextFibLevel.level}`
                    });
                }
                
                return predictions;
            }

            // ุญุณุงุจ ูุณุชูู ุงูุซูุฉ ุงูุฅุฌูุงูู
            calculateConfidence(analysis) {
                let confidence = 0;
                let factors = 0;
                
                // ุซูุฉ ุงูููุฌุงุช
                if (analysis.waves.length > 0) {
                    const avgWaveConfidence = analysis.waves.reduce((sum, w)
                    const avgWaveConfidence = analysis.waves.reduce((sum, w) => sum + w.confidence, 0) / analysis.waves.length;
                    confidence += avgWaveConfidence * 0.3;
                    factors += 0.3;
                }
                
                // ุซูุฉ ุงูุฃููุงุท
                if (analysis.patterns.length > 0) {
                    const avgPatternConfidence = analysis.patterns.reduce((sum, p) => sum + p.confidence, 0) / analysis.patterns.length;
                    confidence += avgPatternConfidence * 0.25;
                    factors += 0.25;
                }
                
                // ุซูุฉ ุงูุงุชุฌุงู
                confidence += analysis.trend.strength * 0.25;
                factors += 0.25;
                
                // ุซูุฉ ุงูุชููุนุงุช
                if (analysis.predictions.length > 0) {
                    const avgPredictionConfidence = analysis.predictions.reduce((sum, p) => sum + p.probability, 0) / analysis.predictions.length;
                    confidence += avgPredictionConfidence * 0.2;
                    factors += 0.2;
                }
                
                return Math.round(confidence / factors);
            }
        }

        // API ูุชูุฏู ููุนููุงุช ุงููุดูุฑุฉ
        class AdvancedCryptoAPI {
            constructor() {
                this.baseURL = 'https://api1.binance.com/api/v3';
                this.requestCount = 0;
                this.rateLimitDelay = 200;
                this.popularSymbols = [
                    'BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'ADAUSDT', 'XRPUSDT',
                    'SOLUSDT', 'DOTUSDT', 'DOGEUSDT', 'AVAXUSDT', 'LUNAUSDT',
                    'SHIBUSDT', 'MATICUSDT', 'LTCUSDT', 'LINKUSDT', 'UNIUSDT',
                    'ATOMUSDT', 'ETCUSDT', 'XLMUSDT', 'BCHUSDT', 'FILUSDT',
                    'TRXUSDT', 'EOSUSDT', 'AAVEUSDT', 'GRTUSDT', 'MKRUSDT',
                    'COMPUSDT', 'YFIUSDT', 'SUSHIUSDT', 'SNXUSDT', 'CRVUSDT',
                    'ALPHAUSDT', 'ZENUSDT', 'KSMUSDT', 'CHZUSDT', 'SANDUSDT',
                    'MANAUSDT', 'ENJUSDT', 'GALAUSDT', 'AXSUSDT', 'FTMUSDT'
                ];
            }

            async getKlines(symbol, interval, limit = 500) {
                try {
                    await this.rateLimitCheck();
                    
                    const url = `${this.baseURL}/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ูุดู ูู ุฌูุจ ุจูุงูุงุช ${symbol}`);
                    }
                    
                    const data = await response.json();
                    this.requestCount++;
                    
                    return data.map(candle => ({
                        timestamp: candle[0],
                        open: parseFloat(candle[1]),
                        high: parseFloat(candle[2]),
                        low: parseFloat(candle[3]),
                        close: parseFloat(candle[4]),
                        volume: parseFloat(candle[5])
                    }));
                    
                } catch (error) {
                    console.error(`ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช ${symbol}:`, error.message);
                    throw error;
                }
            }

            async getAllSymbols() {
                try {
                    const response = await fetch(`${this.baseURL}/exchangeInfo`);
                    const data = await response.json();
                    
                    return data.symbols
                        .filter(s => s.status === 'TRADING' && s.symbol.endsWith('USDT'))
                        .map(s => s.symbol)
                        .slice(0, 100); // ุฃูู 100 ุฑูุฒ
                        
                } catch (error) {
                    console.warn('ูุดู ูู ุฌูุจ ูุงุฆูุฉ ุงูุฑููุฒุ ุงุณุชุฎุฏุงู ุงููุงุฆูุฉ ุงูุงูุชุฑุงุถูุฉ');
                    return this.popularSymbols;
                }
            }

            async rateLimitCheck() {
                const now = Date.now();
                if (this.lastRequestTime && (now - this.lastRequestTime) < this.rateLimitDelay) {
                    await new Promise(resolve => 
                        setTimeout(resolve, this.rateLimitDelay - (now - this.lastRequestTime))
                    );
                }
                this.lastRequestTime = Date.now();
            }

            getUsageStats() {
                return {
                    totalRequests: this.requestCount,
                    lastRequestTime: this.lastRequestTime,
                    rateLimitDelay: this.rateLimitDelay
                };
            }
        }

        // ุงูุชุทุจูู ุงูุฑุฆูุณู ุงููุชูุฏู
        class AdvancedElliottWaveApp {
            constructor() {
                this.api = new AdvancedCryptoAPI();
                this.analyzer = new AdvancedElliottWaveAnalyzer();
                this.chart = null;
                this.analysisHistory = [];
            }

            async analyzeSymbol(symbol, interval, limit) {
                try {
                    const data = await this.api.getKlines(symbol, interval, limit);
                    const analysis = this.analyzer.analyzeData(data);
                    
                    const result = {
                        success: true,
                        symbol,
                        interval,
                        timestamp: Date.now(),
                        data,
                        analysis,
                        summary: this.generateSummary(analysis)
                    };
                    
                    this.analysisHistory.unshift(result);
                    if (this.analysisHistory.length > 50) {
                        this.analysisHistory = this.analysisHistory.slice(0, 50);
                    }
                    
                    return result;
                    
                } catch (error) {
                    return {
                        success: false,
                        symbol,
                        interval,
                        timestamp: Date.now(),
                        error: error.message
                    };
                }
            }

            async scanMarket(symbols = null, interval = '4h') {
                if (!symbols) {
                    symbols = await this.api.getAllSymbols();
                }
                
                const results = [];
                const batchSize = 5;
                
                for (let i = 0; i < symbols.length; i += batchSize) {
                    const batch = symbols.slice(i, i + batchSize);
                    const batchPromises = batch.map(symbol => 
                        this.analyzeSymbol(symbol, interval, 200)
                    );
                    
                    const batchResults = await Promise.allSettled(batchPromises);
                    
                    batchResults.forEach((result, index) => {
                        if (result.status === 'fulfilled') {
                            results.push(result.value);
                        } else {
                            results.push({
                                success: false,
                                symbol: batch[index],
                                error: result.reason.message
                            });
                        }
                    });
                    
                    // ุชุญุฏูุซ ุดุฑูุท ุงูุชูุฏู
                    const progress = Math.round(((i + batchSize) / symbols.length) * 100);
                    this.updateProgress(`ูุณุญ ุงูุณูู: ${progress}%`);
                    
                    // ุชุฃุฎูุฑ ุจูู ุงููุฌููุนุงุช
                    if (i + batchSize < symbols.length) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
                
                return results.filter(r => r.success).sort((a, b) => b.analysis.confidence - a.analysis.confidence);
            }

            generateSummary(analysis) {
                const summary = {
                    trend: this.getTrendDescription(analysis.trend),
                    waveCount: analysis.waves.length,
                    patternCount: analysis.patterns.length,
                    confidence: analysis.confidence,
                    recommendation: this.getRecommendation(analysis),
                    riskLevel: this.getRiskLevel(analysis)
                };
                
                return summary;
            }

            getTrendDescription(trend) {
                const descriptions = {
                    'strong_bullish': 'ุงุชุฌุงู ุตุงุนุฏ ููู ุฌุฏุงู ๐',
                    'bullish': 'ุงุชุฌุงู ุตุงุนุฏ ๐',
                    'strong_bearish': 'ุงุชุฌุงู ูุงุจุท ููู ุฌุฏุงู ๐',
                    'bearish': 'ุงุชุฌุงู ูุงุจุท ๐',
                    'sideways': 'ุญุฑูุฉ ุฌุงูุจูุฉ โ๏ธ'
                };
                
                return descriptions[trend.direction] || 'ุบูุฑ ูุญุฏุฏ';
            }

            getRecommendation(analysis) {
                if (analysis.confidence < 50) return 'ุงูุชุธุงุฑ - ุซูุฉ ููุฎูุถุฉ';
                
                if (analysis.trend.direction.includes('bullish')) {
                    return analysis.confidence > 70 ? 'ุดุฑุงุก ููู ๐ข' : 'ุดุฑุงุก ๐ข';
                } else if (analysis.trend.direction.includes('bearish')) {
                    return analysis.confidence > 70 ? 'ุจูุน ููู ๐ด' : 'ุจูุน ๐ด';
                }
                
                return 'ุงูุชุธุงุฑ โณ';
            }

            getRiskLevel(analysis) {
                if (analysis.confidence > 80) return 'ููุฎูุถ';
                if (analysis.confidence > 60) return 'ูุชูุณุท';
                return 'ุนุงูู';
            }

            updateProgress(text) {
                const loadingText = document.getElementById('loadingText');
                if (loadingText) {
                    loadingText.textContent = text;
                }
            }

            drawChart(result) {
                const ctx = document.getElementById('priceChart').getContext('2d');
                
                if (this.chart) {
                    this.chart.destroy();
                }
                
                const labels = result.data.map(d => new Date(d.timestamp).toLocaleDateString('ar-SA'));
                const prices = result.data.map(d => d.close);
                
                // ุฅุถุงูุฉ ููุงุท ุงูููุฌุงุช
                const waveAnnotations = result.analysis.waves.map(wave => ({
                    type: 'point',
                    xValue: labels[wave.endIndex],
                    yValue: wave.endPrice,
                    backgroundColor: wave.type === 'impulse' ? 'rgba(40, 167, 69, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                    radius: 8,
                    label: {
                        content: wave.label,
                        enabled: true,
                        position: 'top'
                    }
                }));
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ุงูุณุนุฑ',
                            data: prices,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.1,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: `${result.symbol} - ${result.interval}`
                            },
                            annotation: {
                                annotations: waveAnnotations
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
        }

        // ุฅูุดุงุก ุงูุชุทุจูู
        const app = new AdvancedElliottWaveApp();
        
        // ุงูุนูุงุตุฑ
        const analyzeBtn = document.getElementById('analyzeBtn');
        const scanBtn = document.getElementById('scanBtn');
        const loadingBar = document.getElementById('loadingBar');
        const analysisDetails = document.getElementById('analysisDetails');
        const waveDetails = document.getElementById('waveDetails');
        const fibonacciLevels = document.getElementById('fibonacciLevels');
        const detectedPatterns = document.getElementById('detectedPatterns');
        const advancedRecommendations = document.getElementById('advancedRecommendations');

        // ุฏุงูุฉ ุงูุชุญููู ุงููุชูุฏู
        async function analyzeAdvanced() {
            const symbol = document.getElementById('symbolInput').value.toUpperCase();
            const interval = document.getElementById('intervalSelect').value;
            const limit = parseInt(document.getElementById('limitSelect').value);
            
            if (!symbol) {
                alert('ูุฑุฌู ุฅุฏุฎุงู ุฑูุฒ ุงูุนููุฉ');
                return;
            }

            showLoading('ุฌุงุฑู ุงูุชุญููู ุงููุชูุฏู...');
            
            try {
                const result = await app.analyzeSymbol(symbol, interval, limit);
                
                if (result.success) {
                    displayAdvancedAnalysis(result);
                    app.drawChart(result);
                } else {
                    showError(result.error);
                }
                
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        // ุฏุงูุฉ ูุณุญ ุงูุณูู
        async function scanMarket() {
            showLoading('ุฌุงุฑู ูุณุญ ุงูุณูู...');
            
            try {
                const results = await app.scanMarket(null, '4h');
                displayMarketScan(results);
                
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        // ุนุฑุถ ุงูุชุญููู ุงููุชูุฏู
        function displayAdvancedAnalysis(result) {
            const analysis = result.analysis;
            
            // ุชูุงุตูู ุงูุชุญููู ุงูุฑุฆูุณูุฉ
            analysisDetails.innerHTML = `
                <div class="card mb-3 ${getConfidenceClass(analysis.confidence)}">
                    <div class="card-header">
                        <h6>ููุฎุต ุงูุชุญููู</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <strong>ุงูุงุชุฌุงู:</strong><br>
                                <span class="badge bg-primary">${result.summary.trend}</span>
                            </div>
                            <div class="col-6">
                                <strong>ูุณุชูู ุงูุซูุฉ:</strong><br>
                                <span class="badge bg-info">${analysis.confidence}%</span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col
                            <div class="col-6">
                                <strong>ุนุฏุฏ ุงูููุฌุงุช:</strong><br>
                                <span class="badge bg-success">${result.summary.waveCount}</span>
                            </div>
                            <div class="col-6">
                                <strong>ุงูุฃููุงุท ุงูููุชุดูุฉ:</strong><br>
                                <span class="badge bg-warning">${result.summary.patternCount}</span>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <strong>ุงูุชูุตูุฉ:</strong><br>
                            <span class="badge bg-${getRecommendationColor(result.summary.recommendation)} fs-6">
                                ${result.summary.recommendation}
                            </span>
                        </div>
                        <div class="mt-2 text-center">
                            <small class="text-muted">ูุณุชูู ุงููุฎุงุทุฑุฉ: ${result.summary.riskLevel}</small>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-3">
                    <div class="card-header">
                        <h6>ุชุญููู ุงูุงุชุฌุงู</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            <small>ุงูุณุนุฑ ุงูุญุงูู:</small>
                            <strong>${analysis.trend.currentPrice.toFixed(4)}</strong>
                        </div>
                        <div class="mb-2">
                            <small>ุงููุชูุณุท ูุตูุฑ ุงููุฏู:</small>
                            <span class="${analysis.trend.currentPrice > analysis.trend.shortMA ? 'text-success' : 'text-danger'}">
                                ${analysis.trend.shortMA.toFixed(4)}
                            </span>
                        </div>
                        <div class="mb-2">
                            <small>ุงููุชูุณุท ูุชูุณุท ุงููุฏู:</small>
                            <span class="${analysis.trend.shortMA > analysis.trend.mediumMA ? 'text-success' : 'text-danger'}">
                                ${analysis.trend.mediumMA.toFixed(4)}
                            </span>
                        </div>
                        <div class="mb-2">
                            <small>ุงููุชูุณุท ุทููู ุงููุฏู:</small>
                            <span class="${analysis.trend.mediumMA > analysis.trend.longMA ? 'text-success' : 'text-danger'}">
                                ${analysis.trend.longMA.toFixed(4)}
                            </span>
                        </div>
                        <div class="progress mt-3">
                            <div class="progress-bar bg-${analysis.trend.strength > 70 ? 'success' : analysis.trend.strength > 40 ? 'warning' : 'danger'}" 
                                 style="width: ${analysis.trend.strength}%">
                                ููุฉ ุงูุงุชุฌุงู: ${analysis.trend.strength}%
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h6>ุงูุฏุนู ูุงูููุงููุฉ</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <strong class="text-danger">ููุงููุฉ:</strong><br>
                                ${analysis.support_resistance.resistance.slice(0, 3).map(r => 
                                    `<small class="d-block">${r.toFixed(4)}</small>`
                                ).join('')}
                            </div>
                            <div class="col-6">
                                <strong class="text-success">ุฏุนู:</strong><br>
                                ${analysis.support_resistance.support.slice(0, 3).map(s => 
                                    `<small class="d-block">${s.toFixed(4)}</small>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ุชูุงุตูู ุงูููุฌุงุช
            displayWaveDetails(analysis.waves);
            
            // ูุณุชููุงุช ููุจููุงุชุดู
            displayFibonacciLevels(analysis.fibonacci);
            
            // ุงูุฃููุงุท ุงูููุชุดูุฉ
            displayDetectedPatterns(analysis.patterns);
            
            // ุงูุชูุตูุงุช ุงููุชูุฏูุฉ
            displayAdvancedRecommendations(analysis.predictions, result.summary);
        }

        // ุนุฑุถ ุชูุงุตูู ุงูููุฌุงุช
        function displayWaveDetails(waves) {
            if (waves.length === 0) {
                waveDetails.innerHTML = '<div class="alert alert-info">ูู ูุชู ุงูุชุดุงู ููุฌุงุช ูุงุถุญุฉ</div>';
                return;
            }

            const waveTable = waves.map(wave => `
                <tr class="${wave.type === 'impulse' ? 'table-success' : 'table-warning'}">
                    <td>
                        <span class="badge bg-${wave.type === 'impulse' ? 'success' : 'danger'}">
                            ${wave.label}
                        </span>
                    </td>
                    <td>
                        <span class="wave-${wave.type}">${wave.type === 'impulse' ? 'ุฏุงูุนุฉ' : 'ุชุตุญูุญูุฉ'}</span>
                    </td>
                    <td>
                        <i class="fas fa-arrow-${wave.direction === 'up' ? 'up text-success' : 'down text-danger'}"></i>
                        ${wave.direction === 'up' ? 'ุตุงุนุฏ' : 'ูุงุจุท'}
                    </td>
                    <td>${wave.startPrice.toFixed(4)}</td>
                    <td>${wave.endPrice.toFixed(4)}</td>
                    <td>${wave.length.toFixed(4)}</td>
                    <td>${wave.duration}</td>
                    <td>
                        <div class="progress" style="height: 15px;">
                            <div class="progress-bar bg-${wave.confidence > 70 ? 'success' : wave.confidence > 50 ? 'warning' : 'danger'}" 
                                 style="width: ${wave.confidence}%">
                                ${wave.confidence.toFixed(0)}%
                            </div>
                        </div>
                    </td>
                </tr>
            `).join('');

            waveDetails.innerHTML = `
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ุงูููุฌุฉ</th>
                                <th>ุงูููุน</th>
                                <th>ุงูุงุชุฌุงู</th>
                                <th>ุณุนุฑ ุงูุจุฏุงูุฉ</th>
                                <th>ุณุนุฑ ุงูููุงูุฉ</th>
                                <th>ุงูุทูู</th>
                                <th>ุงููุฏุฉ</th>
                                <th>ุงูุซูุฉ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${waveTable}
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-3">
                    <div class="row">
                        <div class="col-6">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-success">ููุฌุงุช ุฏุงูุนุฉ</h6>
                                    <h4 class="text-success">${waves.filter(w => w.type === 'impulse').length}</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card border-danger">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-danger">ููุฌุงุช ุชุตุญูุญูุฉ</h6>
                                    <h4 class="text-danger">${waves.filter(w => w.type === 'corrective').length}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ุนุฑุถ ูุณุชููุงุช ููุจููุงุชุดู
        function displayFibonacciLevels(fibonacci) {
            const currentPrice = fibonacci.high - (fibonacci.range * 0.5); // ุชูุฏูุฑ ุงูุณุนุฑ ุงูุญุงูู
            
            const fibTable = fibonacci.levels.map(level => {
                const distance = Math.abs(level.price - currentPrice);
                const isNear = distance < (fibonacci.range * 0.05);
                
                return `
                    <tr class="${isNear ? 'table-warning' : ''} ${level.type === 'strong' ? 'fibonacci-level' : ''}">
                        <td>
                            <span class="badge bg-${level.type === 'strong' ? 'warning' : level.type === 'medium' ? 'info' : 'secondary'}">
                                ${level.level}
                            </span>
                        </td>
                        <td>${level.price.toFixed(4)}</td>
                        <td>
                            <span class="badge bg-${level.type === 'strong' ? 'danger' : level.type === 'medium' ? 'warning' : 'secondary'}">
                                ${level.type === 'strong' ? 'ููู' : level.type === 'medium' ? 'ูุชูุณุท' : 'ุถุนูู'}
                            </span>
                        </td>
                        <td>
                            ${isNear ? '<i class="fas fa-bullseye text-warning"></i> ูุฑูุจ' : ''}
                        </td>
                    </tr>
                `;
            }).join('');

            fibonacciLevels.innerHTML = `
                <div class="mb-3">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="card border-success">
                                <div class="card-body">
                                    <small>ุฃุนูู ุณุนุฑ</small>
                                    <h6 class="text-success">${fibonacci.high.toFixed(4)}</h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card border-info">
                                <div class="card-body">
                                    <small>ุงููุฏู</small>
                                    <h6 class="text-info">${fibonacci.range.toFixed(4)}</h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card border-danger">
                                <div class="card-body">
                                    <small>ุฃูู ุณุนุฑ</small>
                                    <h6 class="text-danger">${fibonacci.low.toFixed(4)}</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead class="table-dark">
                            <tr>
                                <th>ุงููุณุชูู</th>
                                <th>ุงูุณุนุฑ</th>
                                <th>ุงูููุฉ</th>
                                <th>ุงูุญุงูุฉ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${fibTable}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // ุนุฑุถ ุงูุฃููุงุท ุงูููุชุดูุฉ
        function displayDetectedPatterns(patterns) {
            if (patterns.length === 0) {
                detectedPatterns.innerHTML = '<div class="alert alert-info">ูู ูุชู ุงูุชุดุงู ุฃููุงุท ูุงุถุญุฉ</div>';
                return;
            }

            const patternCards = patterns.map(pattern => `
                <div class="card mb-3 pattern-detected">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-title">
                                    <i class="fas fa-chart-line"></i>
                                    ${pattern.type}
                                </h6>
                                <p class="card-text">${pattern.description}</p>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-${pattern.confidence > 70 ? 'success' : pattern.confidence > 50 ? 'warning' : 'danger'} fs-6">
                                    ${pattern.confidence}%
                                </span>
                                <br>
                                <small class="text-muted">${pattern.direction}</small>
                            </div>
                        </div>
                        
                        ${pattern.target ? `
                            <div class="mt-2">
                                <small><strong>ุงููุฏู ุงููุชููุน:</strong> ${pattern.target.toFixed(4)}</small>
                            </div>
                        ` : ''}
                        
                        ${pattern.neckline ? `
                            <div class="mt-1">
                                <small><strong>ุฎุท ุงูุนูู:</strong> ${pattern.neckline.toFixed(4)}</small>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            detectedPatterns.innerHTML = patternCards;
        }

        // ุนุฑุถ ุงูุชูุตูุงุช ุงููุชูุฏูุฉ
        function displayAdvancedRecommendations(predictions, summary) {
            const recommendationCards = predictions.map(pred => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-title">
                                    <i class="fas fa-${pred.direction === 'up' ? 'arrow-up text-success' : 'arrow-down text-danger'}"></i>
                                    ุชููุน ${pred.timeframe === 'short' ? 'ูุตูุฑ ุงููุฏู' : 'ูุชูุณุท ุงููุฏู'}
                                </h6>
                                <p class="card-text">${pred.reasoning}</p>
                                <div class="mt-2">
                                    <strong>ุงููุฏู:</strong> 
                                    <span class="badge bg-${pred.direction === 'up' ? 'success' : 'danger'}">
                                        ${pred.target.toFixed(4)}
                                    </span>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="progress" style="width: 80px; height: 20px;">
                                    <div class="progress-bar bg-${pred.probability > 70 ? 'success' : pred.probability > 50 ? 'warning' : 'danger'}" 
                                         style="width: ${pred.probability}%">
                                        ${pred.probability}
                                        ${pred.probability}%
                                    </div>
                                </div>
                                <small class="text-muted">ุงุญุชูุงููุฉ</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            const riskManagement = `
                <div class="card border-warning mb-3">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0">
                            <i class="fas fa-shield-alt"></i>
                            ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <strong>ูุณุชูู ุงููุฎุงุทุฑุฉ:</strong>
                                <span class="badge bg-${summary.riskLevel === 'ููุฎูุถ' ? 'success' : summary.riskLevel === 'ูุชูุณุท' ? 'warning' : 'danger'}">
                                    ${summary.riskLevel}
                                </span>
                            </div>
                            <div class="col-md-6">
                                <strong>ุญุฌู ุงููุฑูุฒ ุงูููุชุฑุญ:</strong>
                                <span class="badge bg-info">
                                    ${summary.riskLevel === 'ููุฎูุถ' ? '3-5%' : summary.riskLevel === 'ูุชูุณุท' ? '1-3%' : '0.5-1%'}
                                </span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-12">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i>
                                    ${getRiskAdvice(summary.riskLevel)}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const tradingPlan = `
                <div class="card border-primary">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-line"></i>
                            ุฎุทุฉ ุงูุชุฏุงูู
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6 class="text-success">ููุทุฉ ุงูุฏุฎูู</h6>
                                    <span class="badge bg-success fs-6">
                                        ${predictions.length > 0 ? 'ุงูุณุนุฑ ุงูุญุงูู' : 'ุงูุชุธุงุฑ'}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6 class="text-warning">ููู ุงูุฎุณุงุฑุฉ</h6>
                                    <span class="badge bg-warning fs-6">
                                        ${summary.riskLevel === 'ููุฎูุถ' ? '2-3%' : summary.riskLevel === 'ูุชูุณุท' ? '1-2%' : '0.5-1%'}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6 class="text-info">ุฌูู ุงูุฃุฑุจุงุญ</h6>
                                    <span class="badge bg-info fs-6">
                                        ${predictions.length > 0 ? 'ุญุณุจ ุงููุฏู' : 'ุบูุฑ ูุญุฏุฏ'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            advancedRecommendations.innerHTML = `
                ${riskManagement}
                ${predictions.length > 0 ? recommendationCards : '<div class="alert alert-info">ูุง ุชูุฌุฏ ุชููุนุงุช ูุงุถุญุฉ ุญุงููุงู</div>'}
                ${tradingPlan}
            `;
        }

        // ุนุฑุถ ูุชุงุฆุฌ ูุณุญ ุงูุณูู
        function displayMarketScan(results) {
            const topOpportunities = results.slice(0, 10);
            
            const scanTable = topOpportunities.map((result, index) => `
                <tr class="cursor-pointer" onclick="loadSymbolAnalysis('${result.symbol}')">
                    <td>${index + 1}</td>
                    <td>
                        <strong>${result.symbol}</strong>
                        <br>
                        <small class="text-muted">${result.summary.trend}</small>
                    </td>
                    <td>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-${result.analysis.confidence > 70 ? 'success' : result.analysis.confidence > 50 ? 'warning' : 'danger'}" 
                                 style="width: ${result.analysis.confidence}%">
                                ${result.analysis.confidence}%
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge bg-${getRecommendationColor(result.summary.recommendation)}">
                            ${result.summary.recommendation}
                        </span>
                    </td>
                    <td>${result.summary.waveCount}</td>
                    <td>${result.summary.patternCount}</td>
                    <td>
                        <span class="badge bg-${result.summary.riskLevel === 'ููุฎูุถ' ? 'success' : result.summary.riskLevel === 'ูุชูุณุท' ? 'warning' : 'danger'}">
                            ${result.summary.riskLevel}
                        </span>
                    </td>
                </tr>
            `).join('');

            // ุฅูุดุงุก ูุงูุฐุฉ ููุจุซูุฉ ูุนุฑุถ ุงููุชุงุฆุฌ
            const modalHTML = `
                <div class="modal fade" id="marketScanModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-search"></i>
                                    ูุชุงุฆุฌ ูุณุญ ุงูุณูู - ุฃูุถู ${topOpportunities.length} ูุฑุต
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>#</th>
                                                <th>ุงูุฑูุฒ</th>
                                                <th>ูุณุชูู ุงูุซูุฉ</th>
                                                <th>ุงูุชูุตูุฉ</th>
                                                <th>ุงูููุฌุงุช</th>
                                                <th>ุงูุฃููุงุท</th>
                                                <th>ุงููุฎุงุทุฑุฉ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${scanTable}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="mt-4">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="card border-success">
                                                <div class="card-body text-center">
                                                    <h6 class="text-success">ูุฑุต ุนุงููุฉ ุงูุซูุฉ</h6>
                                                    <h4 class="text-success">${results.filter(r => r.analysis.confidence > 70).length}</h4>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-warning">
                                                <div class="card-body text-center">
                                                    <h6 class="text-warning">ูุฑุต ูุชูุณุทุฉ</h6>
                                                    <h4 class="text-warning">${results.filter(r => r.analysis.confidence > 50 && r.analysis.confidence <= 70).length}</h4>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-info">
                                                <div class="card-body text-center">
                                                    <h6 class="text-info">ุฅุฌูุงูู ุงูููุฌุงุช</h6>
                                                    <h4 class="text-info">${results.reduce((sum, r) => sum + r.summary.waveCount, 0)}</h4>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-primary">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">ุฅุฌูุงูู ุงูุฃููุงุท</h6>
                                                    <h4 class="text-primary">${results.reduce((sum, r) => sum + r.summary.patternCount, 0)}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
                                <button type="button" class="btn btn-primary" onclick="exportScanResults()">ุชุตุฏูุฑ ุงููุชุงุฆุฌ</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ุฅุถุงูุฉ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ุฅูู ุงูุตูุญุฉ
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // ุนุฑุถ ุงููุงูุฐุฉ ุงูููุจุซูุฉ
            const modal = new bootstrap.Modal(document.getElementById('marketScanModal'));
            modal.show();
            
            // ุฅุฒุงูุฉ ุงููุงูุฐุฉ ุนูุฏ ุงูุฅุบูุงู
            document.getElementById('marketScanModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // ุชุญููู ุชุญููู ุฑูุฒ ูุนูู ูู ูุชุงุฆุฌ ุงููุณุญ
        async function loadSymbolAnalysis(symbol) {
            document.getElementById('symbolInput').value = symbol;
            const modal = bootstrap.Modal.getInstance(document.getElementById('marketScanModal'));
            modal.hide();
            
            setTimeout(() => {
                analyzeAdvanced();
            }, 500);
        }

        // ุชุตุฏูุฑ ูุชุงุฆุฌ ุงููุณุญ
        function exportScanResults() {
            const results = app.analysisHistory.filter(r => r.success);
            const csvContent = generateCSVReport(results);
            downloadCSV(csvContent, `elliott-wave-scan-${new Date().toISOString().split('T')[0]}.csv`);
        }

        // ุชูููุฏ ุชูุฑูุฑ CSV
        function generateCSVReport(results) {
            const headers = ['ุงูุฑูุฒ', 'ุงููุชุฑุฉ', 'ูุณุชูู ุงูุซูุฉ', 'ุงูุงุชุฌุงู', 'ุงูุชูุตูุฉ', 'ุนุฏุฏ ุงูููุฌุงุช', 'ุนุฏุฏ ุงูุฃููุงุท', 'ุงููุฎุงุทุฑุฉ'];
            const rows = results.map(r => [
                r.symbol,
                r.interval,
                r.analysis.confidence,
                r.summary.trend,
                r.summary.recommendation,
                r.summary.waveCount,
                r.summary.patternCount,
                r.summary.riskLevel
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        // ุชุญููู ููู CSV
        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ุฏูุงู ูุณุงุนุฏุฉ
        function showLoading(text = 'ุฌุงุฑู ุงูุชุญููู...') {
            document.getElementById('loadingText').textContent = text;
            loadingBar.style.display = 'block';
        }

        function hideLoading() {
            loadingBar.style.display = 'none';
        }

        function showError(message) {
            analysisDetails.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>ุฎุทุฃ:</strong> ${message}
                </div>
            `;
        }

        function getConfidenceClass(confidence) {
            if (confidence > 70) return 'high-confidence';
            if (confidence > 50) return 'medium-confidence';
            return 'low-confidence';
        }

        function getRecommendationColor(recommendation) {
            if (recommendation.includes('ุดุฑุงุก')) return 'success';
            if (recommendation.includes('ุจูุน')) return 'danger';
            if (recommendation.includes('ุงูุชุธุงุฑ')) return 'warning';
            return 'secondary';
        }

        function getRiskAdvice(riskLevel) {
            const advice = {
                'ููุฎูุถ': 'ูููู ุฒูุงุฏุฉ ุญุฌู ุงููุฑูุฒ ูุน ูุฑุงูุจุฉ ุฏูููุฉ ููุณูู',
                'ูุชูุณุท': 'ุงุณุชุฎุฏู ุญุฌู ูุฑูุฒ ูุนุชุฏู ูุน ูุถุน ููู ุฎุณุงุฑุฉ ูุญูู',
                'ุนุงูู': 'ุชุฏุงูู ุจุญุฐุฑ ุดุฏูุฏ ูุน ุญุฌู ูุฑูุฒ ุตุบูุฑ ูููู ุฎุณุงุฑุฉ ูุฑูุจ'
            };
            return advice[riskLevel] || 'ุชุฏุงูู ุจุญุฐุฑ';
        }

        // ุฑุจุท ุงูุฃุญุฏุงุซ
        analyzeBtn.addEventListener('click', analyzeAdvanced);
        scanBtn.addEventListener('click', scanMarket);

        // ุชุญููู ุชููุงุฆู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            // ุชุญููู BTC ุงูุชุฑุงุถูุงู
            setTimeout(() => {
                analyzeAdvanced();
            }, 1000);
        });

        // ุฅุถุงูุฉ ุงุฎุชุตุงุฑุงุช ููุญุฉ ุงูููุงุชูุญ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                analyzeAdvanced();
            }
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                scanMarket();
            }
        });

                // ุญูุธ ุงูุฅุนุฏุงุฏุงุช ูู ุงูุชุฎุฒูู ุงููุญูู
        function saveSettings() {
            const settings = {
                defaultSymbol: document.getElementById('symbolInput').value,
                defaultInterval: document.getElementById('intervalSelect').value,
                defaultLimit: document.getElementById('limitSelect').value,
                theme: document.body.classList.contains('dark-theme') ? 'dark' : 'light'
            };
            localStorage.setItem('elliottWaveSettings', JSON.stringify(settings));
        }

        // ุชุญููู ุงูุฅุนุฏุงุฏุงุช ูู ุงูุชุฎุฒูู ุงููุญูู
        function loadSettings() {
            const savedSettings = localStorage.getItem('elliottWaveSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('symbolInput').value = settings.defaultSymbol || 'BTCUSDT';
                document.getElementById('intervalSelect').value = settings.defaultInterval || '4h';
                document.getElementById('limitSelect').value = settings.defaultLimit || '200';
                
                if (settings.theme === 'dark') {
                    toggleTheme();
                }
            }
        }

        // ุชุจุฏูู ุงููุธูุฑ
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            
            // ุชุญุฏูุซ ุฃููููุฉ ุงููุธูุฑ
            const themeIcon = document.querySelector('#themeToggle i');
            if (themeIcon) {
                themeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }
            
            // ุฅุนุงุฏุฉ ุฑุณู ุงูุฑุณู ุงูุจูุงูู ุจุงูุฃููุงู ุงูุฌุฏูุฏุฉ
            if (app.chart) {
                updateChartTheme(isDark);
            }
            
            saveSettings();
        }

        // ุชุญุฏูุซ ูุธูุฑ ุงูุฑุณู ุงูุจูุงูู
        function updateChartTheme(isDark) {
            const chart = app.chart;
            if (!chart) return;
            
            const backgroundColor = isDark ? '#2d3748' : '#ffffff';
            const textColor = isDark ? '#e2e8f0' : '#2d3748';
            const gridColor = isDark ? '#4a5568' : '#e2e8f0';
            
            chart.options.plugins.legend.labels.color = textColor;
            chart.options.scales.x.ticks.color = textColor;
            chart.options.scales.y.ticks.color = textColor;
            chart.options.scales.x.grid.color = gridColor;
            chart.options.scales.y.grid.color = gridColor;
            
            chart.update();
        }

        // ุฅุถุงูุฉ ุชูุจููุงุช ูุฎุตุตุฉ
        class AlertManager {
            constructor() {
                this.alerts = JSON.parse(localStorage.getItem('elliottWaveAlerts') || '[]');
                this.checkInterval = null;
            }

            addAlert(symbol, condition, value, message) {
                const alert = {
                    id: Date.now(),
                    symbol,
                    condition, // 'above', 'below', 'pattern', 'wave'
                    value,
                    message,
                    active: true,
                    created: new Date().toISOString()
                };
                
                this.alerts.push(alert);
                this.saveAlerts();
                this.startChecking();
                
                return alert.id;
            }

            removeAlert(id) {
                this.alerts = this.alerts.filter(alert => alert.id !== id);
                this.saveAlerts();
                
                if (this.alerts.length === 0) {
                    this.stopChecking();
                }
            }

            async checkAlerts() {
                for (const alert of this.alerts.filter(a => a.active)) {
                    try {
                        const result = await app.analyzeSymbol(alert.symbol, '1h', 50);
                        if (result.success) {
                            const triggered = this.evaluateCondition(alert, result);
                            if (triggered) {
                                this.triggerAlert(alert);
                                alert.active = false;
                            }
                        }
                    } catch (error) {
                        console.error(`ุฎุทุฃ ูู ูุญุต ุงูุชูุจูู ${alert.id}:`, error);
                    }
                }
                
                this.saveAlerts();
            }

            evaluateCondition(alert, result) {
                const currentPrice = result.data[result.data.length - 1].close;
                
                switch (alert.condition) {
                    case 'above':
                        return currentPrice > alert.value;
                    case 'below':
                        return currentPrice < alert.value;
                    case 'pattern':
                        return result.analysis.patterns.some(p => p.type === alert.value);
                    case 'wave':
                        return result.analysis.waves.some(w => w.label === alert.value);
                    case 'confidence':
                        return result.analysis.confidence > alert.value;
                    default:
                        return false;
                }
            }

            triggerAlert(alert) {
                // ุฅุดุนุงุฑ ุงููุชุตูุญ
                if (Notification.permission === 'granted') {
                    new Notification('ุชูุจูู Elliott Wave', {
                        body: alert.message,
                        icon: '/favicon.ico'
                    });
                }
                
                // ุฅุดุนุงุฑ ูู ุงูุตูุญุฉ
                this.showPageNotification(alert);
                
                // ุตูุช ุงูุชูุจูู
                this.playAlertSound();
            }

            showPageNotification(alert) {
                const notification = document.createElement('div');
                notification.className = 'alert alert-warning alert-dismissible fade show position-fixed';
                notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
                notification.innerHTML = `
                    <strong>${alert.symbol}</strong><br>
                    ${alert.message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                document.body.appendChild(notification);
                
                // ุฅุฒุงูุฉ ุงูุชูุจูู ุจุนุฏ 10 ุซูุงู
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 10000);
            }

            playAlertSound() {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
                audio.play().catch(() => {}); // ุชุฌุงูู ุงูุฃุฎุทุงุก
            }

            startChecking() {
                if (this.checkInterval) return;
                
                this.checkInterval = setInterval(() => {
                    this.checkAlerts();
                }, 60000); // ูุญุต ูู ุฏูููุฉ
            }

            stopChecking() {
                if (this.checkInterval) {
                    clearInterval(this.checkInterval);
                    this.checkInterval = null;
                }
            }

            saveAlerts() {
                localStorage.setItem('elliottWaveAlerts', JSON.stringify(this.alerts));
            }

            getActiveAlerts() {
                return this.alerts.filter(a => a.active);
            }
        }

        // ุฅูุดุงุก ูุฏูุฑ ุงูุชูุจููุงุช
        const alertManager = new AlertManager();

        // ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุชูุจููุงุช
        function showAlertManager() {
            const modalHTML = `
                <div class="modal fade" id="alertModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-bell"></i>
                                    ุฅุฏุงุฑุฉ ุงูุชูุจููุงุช
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <button class="btn btn-primary" onclick="showAddAlertForm()">
                                            <i class="fas fa-plus"></i>
                                            ุฅุถุงูุฉ ุชูุจูู ุฌุฏูุฏ
                                        </button>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <span class="badge bg-info">
                                            ุงูุชูุจููุงุช ุงููุดุทุฉ: ${alertManager.getActiveAlerts().length}
                                        </span>
                                    </div>
                                </div>
                                
                                <div id="alertsList">
                                    ${renderAlertsList()}
                                </div>
                                
                                <div id="addAlertForm" style="display: none;">
                                    ${renderAddAlertForm()}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
            const modal = new bootstrap.Modal(document.getElementById('alertModal'));
            modal.show();
            
            document.getElementById('alertModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        function renderAlertsList() {
            const alerts = alertManager.alerts;
            
            if (alerts.length === 0) {
                return '<div class="alert alert-info">ูุง ุชูุฌุฏ ุชูุจููุงุช ูุญููุธุฉ</div>';
            }
            
            return alerts.map(alert => `
                <div class="card mb-2 ${alert.active ? '' : 'opacity-50'}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-title">
                                    ${alert.symbol}
                                    <span class="badge bg-${alert.active ? 'success' : 'secondary'}">
                                        ${alert.active ? 'ูุดุท' : 'ููุชูู'}
                                    </span>
                                </h6>
                                <p class="card-text">${alert.message}</p>
                                <small class="text-muted">
                                    ${getConditionText(alert)} | 
                                    ุชู ุงูุฅูุดุงุก: ${new Date(alert.created).toLocaleDateString('ar-SA')}
                                </small>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-danger" onclick="removeAlert(${alert.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAddAlertForm() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h6>ุฅุถุงูุฉ ุชูุจูู ุฌุฏูุฏ</h6>
                    </div>
                    <div class="card-body">
                        <form id="alertForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">ุฑูุฒ ุงูุนููุฉ</label>
                                    <input type="text" class="form-control" id="alertSymbol" placeholder="BTCUSDT" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">ููุน ุงูุชูุจูู</label>
                                    <select class="form-select" id="alertCondition" onchange="updateAlertValueField()" required>
                                        <option value="above">ุงูุณุนุฑ ุฃุนูู ูู</option>
                                        <option value="below">ุงูุณุนุฑ ุฃูู ูู</option>
                                        <option value="confidence">ูุณุชูู ุงูุซูุฉ ุฃุนูู ูู</option>
                                        <option value="pattern">ุงูุชุดุงู ููุท</option>
                                        <option value="wave">ุงูุชุดุงู ููุฌุฉ</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ุงููููุฉ</label>
                                <input type="number" class="form-control" id="alertValue" step="0.0001" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ุฑุณุงูุฉ ุงูุชูุจูู</label>
                                <textarea class="form-control" id="alertMessage" rows="2" placeholder="ูุตู ุงูุชูุจูู..." required></textarea>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i>
                                    ุญูุธ ุงูุชูุจูู
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="hideAddAlertForm()">
                                    ุฅูุบุงุก
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function showAddAlertForm() {
            document.getElementById('addAlertForm').style.display = 'block';
            document.getElementById('alertSymbol').value = document.getElementById('symbolInput').value;
        }

        function hideAddAlertForm() {
            document.getElementById('addAlertForm').style.display = 'none';
        }

        function updateAlertValueField() {
            const condition = document.getElementById('alertCondition').value;
            const valueField = document.getElementById('alertValue');
            
            switch (condition) {
                case 'confidence':
                    valueField.placeholder = '70';
                    valueField.max = '100';
                    valueField.min = '0';
                    break;
                case 'above':
                case 'below':
                    valueField.placeholder = '50000';
                    valueField.removeAttribute('max');
                    valueField.min = '0';
                    break;
                default:
                    valueField.placeholder = '';
            }
        }

              function getConditionText(alert) {
            const conditions = {
                'above': `ุงูุณุนุฑ > ${alert.value}`,
                'below': `ุงูุณุนุฑ < ${alert.value}`,
                'confidence': `ุงูุซูุฉ > ${alert.value}%`,
                'pattern': `ููุท: ${alert.value}`,
                'wave': `ููุฌุฉ: ${alert.value}`
            };
            return conditions[alert.condition] || 'ุบูุฑ ูุญุฏุฏ';
        }

        function removeAlert(id) {
            alertManager.removeAlert(id);
            // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุชูุจููุงุช
            document.getElementById('alertsList').innerHTML = renderAlertsList();
        }

        // ูุนุงูุฌ ูููุฐุฌ ุฅุถุงูุฉ ุงูุชูุจูู
        document.addEventListener('submit', function(e) {
            if (e.target.id === 'alertForm') {
                e.preventDefault();
                
                const symbol = document.getElementById('alertSymbol').value.toUpperCase();
                const condition = document.getElementById('alertCondition').value;
                const value = parseFloat(document.getElementById('alertValue').value);
                const message = document.getElementById('alertMessage').value;
                
                alertManager.addAlert(symbol, condition, value, message);
                
                // ุฅุฎูุงุก ุงููููุฐุฌ ูุชุญุฏูุซ ุงููุงุฆูุฉ
                hideAddAlertForm();
                document.getElementById('alertsList').innerHTML = renderAlertsList();
                
                // ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฌุงุญ
                const successAlert = document.createElement('div');
                successAlert.className = 'alert alert-success alert-dismissible fade show';
                successAlert.innerHTML = `
                    ุชู ุฅุถุงูุฉ ุงูุชูุจูู ุจูุฌุงุญ!
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.querySelector('#alertModal .modal-body').prepend(successAlert);
                
                setTimeout(() => successAlert.remove(), 3000);
            }
        });

        // ุทูุจ ุฅุฐู ุงูุฅุดุนุงุฑุงุช
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('ุชู ุชูุนูู ุงูุฅุดุนุงุฑุงุช', {
                            body: 'ุณุชุชููู ุฅุดุนุงุฑุงุช ุนูุฏ ุชุญูู ุดุฑูุท ุงูุชูุจููุงุช',
                            icon: '/favicon.ico'
                        });
                    }
                });
            }
        }

        // ุฅุถุงูุฉ ุฃุฏูุงุช ุงูุชุญููู ุงูููู ุงููุชูุฏูุฉ
        class TechnicalIndicators {
            static RSI(prices, period = 14) {
                const gains = [];
                const losses = [];
                
                for (let i = 1; i < prices.length; i++) {
                    const change = prices[i] - prices[i - 1];
                    gains.push(change > 0 ? change : 0);
                    losses.push(change < 0 ? Math.abs(change) : 0);
                }
                
                const rsi = [];
                for (let i = period - 1; i < gains.length; i++) {
                    const avgGain = gains.slice(i - period + 1, i + 1).reduce((a, b) => a + b) / period;
                    const avgLoss = losses.slice(i - period + 1, i + 1).reduce((a, b) => a + b) / period;
                    
                    if (avgLoss === 0) {
                        rsi.push(100);
                    } else {
                        const rs = avgGain / avgLoss;
                        rsi.push(100 - (100 / (1 + rs)));
                    }
                }
                
                return rsi;
            }

            static MACD(prices, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
                const emaFast = this.EMA(prices, fastPeriod);
                const emaSlow = this.EMA(prices, slowPeriod);
                
                const macdLine = [];
                for (let i = 0; i < Math.min(emaFast.length, emaSlow.length); i++) {
                    macdLine.push(emaFast[i] - emaSlow[i]);
                }
                
                const signalLine = this.EMA(macdLine, signalPeriod);
                const histogram = [];
                
                for (let i = 0; i < Math.min(macdLine.length, signalLine.length); i++) {
                    histogram.push(macdLine[i] - signalLine[i]);
                }
                
                return {
                    macd: macdLine,
                    signal: signalLine,
                    histogram: histogram
                };
            }

            static EMA(prices, period) {
                const multiplier = 2 / (period + 1);
                const ema = [prices[0]];
                
                for (let i = 1; i < prices.length; i++) {
                    ema.push((prices[i] * multiplier) + (ema[i - 1] * (1 - multiplier)));
                }
                
                return ema;
            }

            static BollingerBands(prices, period = 20, stdDev = 2) {
                const sma = this.SMA(prices, period);
                const bands = { upper: [], middle: [], lower: [] };
                
                for (let i = period - 1; i < prices.length; i++) {
                    const slice = prices.slice(i - period + 1, i + 1);
                    const mean = sma[i - period + 1];
                    const variance = slice.reduce((sum, price) => sum + Math.pow(price - mean, 2), 0) / period;
                    const standardDeviation = Math.sqrt(variance);
                    
                    bands.middle.push(mean);
                    bands.upper.push(mean + (standardDeviation * stdDev));
                    bands.lower.push(mean - (standardDeviation * stdDev));
                }
                
                return bands;
            }

            static SMA(prices, period) {
                const sma = [];
                for (let i = period - 1; i < prices.length; i++) {
                    const sum = prices.slice(i - period + 1, i + 1).reduce((a, b) => a + b);
                    sma.push(sum / period);
                }
                return sma;
            }

            static StochasticOscillator(highs, lows, closes, kPeriod = 14, dPeriod = 3) {
                const k = [];
                
                for (let i = kPeriod - 1; i < closes.length; i++) {
                    const highestHigh = Math.max(...highs.slice(i - kPeriod + 1, i + 1));
                    const lowestLow = Math.min(...lows.slice(i - kPeriod + 1, i + 1));
                    const currentClose = closes[i];
                    
                    k.push(((currentClose - lowestLow) / (highestHigh - lowestLow)) * 100);
                }
                
                const d = this.SMA(k, dPeriod);
                
                return { k, d };
            }
        }

        // ุชุญุณูู ูุญูู Elliott Wave ุจุงููุคุดุฑุงุช ุงููููุฉ
        class EnhancedElliottWaveAnalyzer extends AdvancedElliottWaveAnalyzer {
            analyzeData(data) {
                const baseAnalysis = super.analyzeData(data);
                
                // ุฅุถุงูุฉ ุงููุคุดุฑุงุช ุงููููุฉ
                const prices = data.map(d => d.close);
                const highs = data.map(d => d.high);
                const lows = data.map(d => d.low);
                
                const indicators = {
                    rsi: TechnicalIndicators.RSI(prices),
                    macd: TechnicalIndicators.MACD(prices),
                    bollinger: TechnicalIndicators.BollingerBands(prices),
                    stochastic: TechnicalIndicators.StochasticOscillator(highs, lows, prices)
                };
                
                // ุชุญููู ุงูุฅุดุงุฑุงุช
                const signals = this.analyzeSignals(indicators, baseAnalysis);
                
                return {
                    ...baseAnalysis,
                    indicators,
                    signals,
                    enhancedConfidence: this.calculateEnhancedConfidence(baseAnalysis, signals)
                };
            }

            analyzeSignals(indicators, baseAnalysis) {
                const signals = [];
                
                // ุฅุดุงุฑุงุช RSI
                const currentRSI = indicators.rsi[indicators.rsi.length - 1];
                if (currentRSI > 70) {
                    signals.push({
                        type: 'overbought',
                        indicator: 'RSI',
                        value: currentRSI,
                        signal: 'ุจูุน',
                        strength: Math.min((currentRSI - 70) / 10, 1)
                    });
                } else if (currentRSI < 30) {
                    signals.push({
                        type: 'oversold',
                        indicator: 'RSI',
                        value: currentRSI,
                        signal: 'ุดุฑุงุก',
                        strength: Math.min((30 - currentRSI) / 10, 1)
                    });
                }
                
                // ุฅุดุงุฑุงุช MACD
                const macd = indicators.macd;
                const currentMACD = macd.macd[macd.macd.length - 1];
                const currentSignal = macd.signal[macd.signal.length - 1];
                const previousMACD = macd.macd[macd.macd.length - 2];
                const previousSignal = macd.signal[macd.signal.length - 2];
                
                if (previousMACD <= previousSignal && currentMACD > currentSignal) {
                    signals.push({
                        type: 'bullish_crossover',
                        indicator: 'MACD',
                        signal: 'ุดุฑุงุก',
                        strength: Math.min(Math.abs(currentMACD - currentSignal) / Math.abs(currentMACD), 1)
                    });
                } else if (previousMACD >= previousSignal && currentMACD < currentSignal) {
                    signals.push({
                        type: 'bearish_crossover',
                        indicator: 'MACD',
                        signal: 'ุจูุน',
                        strength: Math.min(Math.abs(currentMACD - currentSignal) / Math.abs(currentMACD), 1)
                    });
                }
                
                // ุฅุดุงุฑุงุช Bollinger Bands
                const bollinger = indicators.bollinger;
                const currentPrice = baseAnalysis.trend.currentPrice;
                const upperBand = bollinger.upper[bollinger.upper.length - 1];
                const lowerBand = bollinger.lower[bollinger.lower.length - 1];
                
                if (currentPrice > upperBand) {
                    signals.push({
                        type: 'price_above_upper_band',
                        indicator: 'Bollinger Bands',
                        signal: 'ุจูุน ูุญุชูู',
                        strength: Math.min((currentPrice - upperBand) / upperBand, 1)
                    });
                } else if (currentPrice < lowerBand) {
                    signals.push({
                        type: 'price_below_lower_band',
                        indicator: 'Bollinger Bands',
                        signal: 'ุดุฑุงุก ูุญุชูู',
                        strength: Math.min((lowerBand - currentPrice) / lowerBand, 1)
                    });
                }
                
                return signals;
            }

            calculateEnhancedConfidence(baseAnalysis, signals) {
                let enhancedConfidence = baseAnalysis.confidence;
                
                // ุชุนุฏูู ุงูุซูุฉ ุจูุงุกู ุนูู ุงูุฅุดุงุฑุงุช
                const bullishSignals = signals.filter(s => s.signal.includes('ุดุฑุงุก')).length;
                const bearishSignals = signals.filter(s => s.signal.includes('ุจูุน')).length;
                
                if (baseAnalysis.trend.direction.includes('bullish') && bullishSignals > bearishSignals) {
                    enhancedConfidence += 10;
                } else if (baseAnalysis.trend.direction.includes('bearish') && bearishSignals > bullishSignals) {
                    enhancedConfidence += 10;
                } else if (bullishSignals > 0 && bearishSignals > 0) {
                    enhancedConfidence -= 5; // ุฅุดุงุฑุงุช ูุชุถุงุฑุจุฉ
                }
                
                return Math.min(Math.max(enhancedConfidence, 0), 100);
            }
        }

        // ุชุญุฏูุซ ุงูุชุทุจูู ูุงุณุชุฎุฏุงู ุงููุญูู ุงููุญุณู
        app.analyzer = new EnhancedElliottWaveAnalyzer();

        // ุฅุถุงูุฉ ูุงุฌูุฉ ุนุฑุถ ุงููุคุดุฑุงุช ุงููููุฉ
        function displayTechnicalIndicators(indicators, signals) {
            const indicatorsHTML = `
                <div class="card mb-3">
                    <div class="card-header">
                        <h6><i class="fas fa-chart-bar"></i> ุงููุคุดุฑุงุช ุงููููุฉ</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="indicator-item">
                                    <strong>RSI (14):</strong>
                                    <span class="badge bg-${getRSIColor(indicators.rsi[indicators.rsi.length - 1])}">
                                        ${indicators.rsi[indicators.rsi.length - 1].toFixed(2)}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="indicator-item">
                                    <strong>MACD:</strong>
                                    <span class="badge bg-${indicators.macd.histogram[indicators.macd.histogram.length - 1] > 0 ? 'success' : 'danger'}">
                                        ${indicators.macd.macd[indicators.macd.macd.length - 1].toFixed(4)}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-2">
                            <div class="col-md-12">
                                <strong>Bollinger Bands:</strong>
                                <div class="d-flex gap-2">
                                    <small>ุงูุนููู: ${indicators.bollinger.upper[indicators.bollinger.upper.length - 1].toFixed(4)}</small>
                                    <small>ุงููุณุท: ${indicators.bollinger.middle[indicators.bollinger.middle.length - 1].toFixed(4)}</small>
                                    <small>ุงูุณููู: ${indicators.bollinger.lower[indicators.bollinger.lower.length - 1].toFixed(4)}</small>
                                </div>
                            </div>
                        </div>
                        </div>
                        
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <div class="indicator-item">
                                    <strong>Stochastic %K:</strong>
                                    <span class="badge bg-${getStochasticColor(indicators.stochastic.k[indicators.stochastic.k.length - 1])}">
                                        ${indicators.stochastic.k[indicators.stochastic.k.length - 1].toFixed(2)}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="indicator-item">
                                    <strong>Stochastic %D:</strong>
                                    <span class="badge bg-${getStochasticColor(indicators.stochastic.d[indicators.stochastic.d.length - 1])}">
                                        ${indicators.stochastic.d[indicators.stochastic.d.length - 1].toFixed(2)}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-3">
                    <div class="card-header">
                        <h6><i class="fas fa-signal"></i> ุงูุฅุดุงุฑุงุช ุงููููุฉ</h6>
                    </div>
                    <div class="card-body">
                        ${signals.length > 0 ? renderSignals(signals) : '<div class="alert alert-info">ูุง ุชูุฌุฏ ุฅุดุงุฑุงุช ูุงุถุญุฉ ุญุงููุงู</div>'}
                    </div>
                </div>
            `;
            
            return indicatorsHTML;
        }

        function renderSignals(signals) {
            return signals.map(signal => `
                <div class="alert alert-${getSignalAlertClass(signal.signal)} d-flex justify-content-between align-items-center">
                    <div>
                        <strong>${signal.indicator}:</strong> ${signal.signal}
                        ${signal.value ? `(${signal.value.toFixed(2)})` : ''}
                    </div>
                    <div>
                        <div class="progress" style="width: 100px; height: 20px;">
                            <div class="progress-bar bg-${getSignalProgressColor(signal.signal)}" 
                                 style="width: ${(signal.strength * 100).toFixed(0)}%">
                                ${(signal.strength * 100).toFixed(0)}%
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getRSIColor(rsi) {
            if (rsi > 70) return 'danger';
            if (rsi < 30) return 'success';
            return 'secondary';
        }

        function getStochasticColor(value) {
            if (value > 80) return 'danger';
            if (value < 20) return 'success';
            return 'secondary';
        }

        function getSignalAlertClass(signal) {
            if (signal.includes('ุดุฑุงุก')) return 'success';
            if (signal.includes('ุจูุน')) return 'danger';
            return 'warning';
        }

        function getSignalProgressColor(signal) {
            if (signal.includes('ุดุฑุงุก')) return 'success';
            if (signal.includes('ุจูุน')) return 'danger';
            return 'warning';
        }

        // ุชุญุฏูุซ ุฏุงูุฉ ุนุฑุถ ุงูุชุญููู ูุชุดูู ุงููุคุดุฑุงุช ุงููููุฉ
        function displayAnalysisResults(result) {
            const { analysis, summary } = result;
            
            // ุนุฑุถ ุงูููุฎุต ุงูุฃุณุงุณู
            analysisDetails.innerHTML = `
                <div class="card mb-3 ${getConfidenceClass(analysis.enhancedConfidence || analysis.confidence)}">
                    <div class="card-header">
                        <h5>ููุฎุต ุงูุชุญููู</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center mb-3">
                            <div class="col-4">
                                <strong>ูุณุชูู ุงูุซูุฉ:</strong><br>
                                <div class="progress mt-2">
                                    <div class="progress-bar bg-${analysis.enhancedConfidence > 70 ? 'success' : analysis.enhancedConfidence > 50 ? 'warning' : 'danger'}" 
                                         style="width: ${analysis.enhancedConfidence || analysis.confidence}%">
                                        ${(analysis.enhancedConfidence || analysis.confidence).toFixed(0)}%
                                    </div>
                                </div>
                            </div>
                            <div class="col-4">
                                <strong>ุงูุงุชุฌุงู ุงูุนุงู:</strong><br>
                                <span class="badge bg-${analysis.trend.direction.includes('bullish') ? 'success' : 'danger'} fs-6">
                                    ${analysis.trend.direction}
                                </span>
                            </div>
                            <div class="col-4">
                                <strong>ููุฉ ุงูุงุชุฌุงู:</strong><br>
                                <span class="badge bg-info fs-6">${analysis.trend.strength}%</span>
                            </div>
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-6">
                                <strong>ุนุฏุฏ ุงูููุฌุงุช:</strong><br>
                                <span class="badge bg-success">${summary.waveCount}</span>
                            </div>
                            <div class="col-6">
                                <strong>ุงูุฃููุงุท ุงูููุชุดูุฉ:</strong><br>
                                <span class="badge bg-warning">${summary.patternCount}</span>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <strong>ุงูุชูุตูุฉ:</strong><br>
                            <span class="badge bg-${getRecommendationColor(summary.recommendation)} fs-6">
                                ${summary.recommendation}
                            </span>
                        </div>
                        <div class="mt-2 text-center">
                            <small class="text-muted">ูุณุชูู ุงููุฎุงุทุฑุฉ: ${summary.riskLevel}</small>
                        </div>
                    </div>
                </div>
                
                ${analysis.indicators ? displayTechnicalIndicators(analysis.indicators, analysis.signals) : ''}
                
                <div class="card mb-3">
                    <div class="card-header">
                        <h6>ุชุญููู ุงูุงุชุฌุงู</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            <small>ุงูุณุนุฑ ุงูุญุงูู:</small>
                            <strong>${analysis.trend.currentPrice.toFixed(4)}</strong>
                        </div>
                        <div class="mb-2">
                            <small>ุงููุชูุณุท ูุตูุฑ ุงููุฏู:</small>
                            <span class="${analysis.trend.currentPrice > analysis.trend.shortMA ? 'text-success' : 'text-danger'}">
                                ${analysis.trend.shortMA.toFixed(4)}
                            </span>
                        </div>
                        <div class="mb-2">
                            <small>ุงููุชูุณุท ูุชูุณุท ุงููุฏู:</small>
                            <span class="${analysis.trend.shortMA > analysis.trend.mediumMA ? 'text-success' : 'text-danger'}">
                                ${analysis.trend.mediumMA.toFixed(4)}
                            </span>
                        </div>
                        <div class="mb-2">
                            <small>ุงููุชูุณุท ุทููู ุงููุฏู:</small>
                            <span class="${analysis.trend.mediumMA > analysis.trend.longMA ? 'text-success' : 'text-danger'}">
                                ${analysis.trend.longMA.toFixed(4)}
                            </span>
                        </div>
                        <div class="progress mt-3">
                            <div class="progress-bar bg-${analysis.trend.strength > 70 ? 'success' : analysis.trend.strength > 40 ? 'warning' : 'danger'}" 
                                 style="width: ${analysis.trend.strength}%">
                                ููุฉ ุงูุงุชุฌุงู: ${analysis.trend.strength}%
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h6>ุงูุฏุนู ูุงูููุงููุฉ</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <strong class="text-danger">ููุงููุฉ:</strong><br>
                                ${analysis.support_resistance.resistance.slice(0, 3).map(r => 
                                    `<small class="d-block">${r.toFixed(4)}</small>`
                                ).join('')}
                            </div>
                            <div class="col-6">
                                <strong class="text-success">ุฏุนู:</strong><br>
                                ${analysis.support_resistance.support.slice(0, 3).map(s => 
                                    `<small class="d-block">${s.toFixed(4)}</small>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ุนุฑุถ ุจุงูู ุงูุชูุงุตูู
            displayWaveDetails(analysis.waves);
            displayFibonacciLevels(analysis.fibonacci);
            displayDetectedPatterns(analysis.patterns);
            displayAdvancedRecommendations(analysis.predictions, summary);
        }

        // ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ุงูุชุญูู ุงูุฅุถุงููุฉ
        function addControlButtons() {
            const controlsHTML = `
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="btn-group me-2" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="toggleTheme()" id="themeToggle">
                                <i class="fas fa-moon"></i>
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="showAlertManager()">
                                <i class="fas fa-bell"></i>
                                ุงูุชูุจููุงุช
                            </button>
                            <button type="button" class="btn btn-outline-success" onclick="exportAnalysis()">
                                <i class="fas fa-download"></i>
                                ุชุตุฏูุฑ
                            </button>
                        </div>
                        
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-warning" onclick="showSettings()">
                                <i class="fas fa-cog"></i>
                                ุงูุฅุนุฏุงุฏุงุช
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="showHelp()">
                                <i class="fas fa-question-circle"></i>
                                ูุณุงุนุฏุฉ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.querySelector('.container').insertAdjacentHTML('afterbegin', controlsHTML);
        }

        // ุชุตุฏูุฑ ุงูุชุญููู
        function exportAnalysis() {
            const lastAnalysis = app.analysisHistory[app.analysisHistory.length - 1];
            if (!lastAnalysis) {
                alert('ูุง ููุฌุฏ ุชุญููู ููุชุตุฏูุฑ');
                return;
            }
            
            const exportData = {
                symbol: lastAnalysis.symbol,
                interval: lastAnalysis.interval,
                timestamp: new Date().toISOString(),
                analysis: lastAnalysis.analysis,
                summary: lastAnalysis.summary
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `elliott-wave-analysis-${lastAnalysis.symbol}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // ุฅุธูุงุฑ ุงูุฅุนุฏุงุฏุงุช
        function showSettings() {
            const settingsHTML = `
                <div class="modal fade" id="settingsModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-cog"></i>
                                    ุงูุฅุนุฏุงุฏุงุช
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="settingsForm">
                                    <div class="mb-3">
                                        <label class="form-label">ุงูุฑูุฒ ุงูุงูุชุฑุงุถู</label>
                                        <input type="text" class="form-control" id="defaultSymbol" value="${document.getElementById('symbolInput').value}">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">ุงููุชุฑุฉ ุงูุงูุชุฑุงุถูุฉ</label>
                                        <select class="form-select" id="defaultInterval">
                                            <option value="1h">ุณุงุนุฉ ูุงุญุฏุฉ</option>
                                            <option value="4h" selected>4 ุณุงุนุงุช</option>
                                            <option value="1d">ููู ูุงุญุฏ</option>
                                            <option value="1w">ุฃุณุจูุน ูุงุญุฏ</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">ุนุฏุฏ ุงูุดููุน ุงูุงูุชุฑุงุถู</label>
                                        <select class="form-select" id="defaultLimit">
                                            <option value="100">100</option>
                                            <option value="200" selected>200</option>
                                            <option value="500">500</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="autoRefresh">
                                            <label class="form-check-label" for="autoRefresh">
                                                ุงูุชุญุฏูุซ ุงูุชููุงุฆู (ูู 5 ุฏูุงุฆู)
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="soundAlerts">
                                            <label class="form-check-label" for="soundAlerts">
                                                                                            <label class="form-check-label" for="soundAlerts">
                                                ุชูุนูู ุงูุฃุตูุงุช ููุชูุจููุงุช
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">ุญุณุงุณูุฉ ุงูุชุดุงู ุงูููุฌุงุช</label>
                                        <input type="range" class="form-range" id="waveSensitivity" min="1" max="10" value="5">
                                        <div class="d-flex justify-content-between">
                                            <small>ููุฎูุถุฉ</small>
                                            <small>ุนุงููุฉ</small>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">ูุณุชูู ุงูุซูุฉ ุงูุฃุฏูู</label>
                                        <input type="range" class="form-range" id="minConfidence" min="30" max="90" value="50">
                                        <div class="d-flex justify-content-between">
                                            <small>30%</small>
                                            <small>90%</small>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                                <button type="button" class="btn btn-primary" onclick="saveUserSettings()">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', settingsHTML);
            const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
            modal.show();
            
            document.getElementById('settingsModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // ุญูุธ ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู
        function saveUserSettings() {
            const settings = {
                defaultSymbol: document.getElementById('defaultSymbol').value,
                defaultInterval: document.getElementById('defaultInterval').value,
                defaultLimit: document.getElementById('defaultLimit').value,
                autoRefresh: document.getElementById('autoRefresh').checked,
                soundAlerts: document.getElementById('soundAlerts').checked,
                waveSensitivity: document.getElementById('waveSensitivity').value,
                minConfidence: document.getElementById('minConfidence').value
            };
            
            localStorage.setItem('elliottWaveUserSettings', JSON.stringify(settings));
            
            // ุชุทุจูู ุงูุฅุนุฏุงุฏุงุช
            document.getElementById('symbolInput').value = settings.defaultSymbol;
            document.getElementById('intervalSelect').value = settings.defaultInterval;
            document.getElementById('limitSelect').value = settings.defaultLimit;
            
            // ุฅุนุฏุงุฏ ุงูุชุญุฏูุซ ุงูุชููุงุฆู
            if (settings.autoRefresh) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
            
            // ุฅุบูุงู ุงููุงูุฐุฉ
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
            
            // ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฌุงุญ
            showNotification('ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ', 'success');
        }

        // ุงูุชุญุฏูุซ ุงูุชููุงุฆู
        let autoRefreshInterval = null;

        function startAutoRefresh() {
            if (autoRefreshInterval) return;
            
            autoRefreshInterval = setInterval(() => {
                if (document.getElementById('symbolInput').value) {
                    analyzeAdvanced();
                }
            }, 5 * 60 * 1000); // ูู 5 ุฏูุงุฆู
            
            showNotification('ุชู ุชูุนูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู', 'info');
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                showNotification('ุชู ุฅููุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู', 'info');
            }
        }

        // ุฅุธูุงุฑ ุงููุณุงุนุฏุฉ
        function showHelp() {
            const helpHTML = `
                <div class="modal fade" id="helpModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-question-circle"></i>
                                    ุฏููู ุงูุงุณุชุฎุฏุงู
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="accordion" id="helpAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#help1">
                                                ูุง ูู ูุธุฑูุฉ Elliott Waveุ
                                            </button>
                                        </h2>
                                        <div id="help1" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                                            <div class="accordion-body">
                                                ูุธุฑูุฉ Elliott Wave ูู ุฃุฏุงุฉ ุชุญููู ููู ุชุนุชูุฏ ุนูู ููุฑุฉ ุฃู ุฃุณุนุงุฑ ุงูุฃุณูุงู ุงููุงููุฉ ุชุชุญุฑู ูู ุฏูุฑุงุช ูุชูุฑุฑุฉ ูู 5 ููุฌุงุช ูู ุงูุงุชุฌุงู ุงูุฑุฆูุณู ู 3 ููุฌุงุช ุชุตุญูุญูุฉ.
                                                <br><br>
                                                <strong>ุงูููุฌุงุช ุงูุฏุงูุนุฉ (1, 3, 5):</strong> ุชุชุญุฑู ูุน ุงูุงุชุฌุงู ุงูุฑุฆูุณู
                                                <br>
                                                <strong>ุงูููุฌุงุช ุงูุชุตุญูุญูุฉ (2, 4):</strong> ุชุชุญุฑู ุถุฏ ุงูุงุชุฌุงู ุงูุฑุฆูุณู
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help2">
                                                ููููุฉ ุงุณุชุฎุฏุงู ุงููุญูู
                                            </button>
                                        </h2>
                                        <div id="help2" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                            <div class="accordion-body">
                                                <ol>
                                                    <li>ุฃุฏุฎู ุฑูุฒ ุงูุนููุฉ ุงููุดูุฑุฉ (ูุซู BTCUSDT)</li>
                                                    <li>ุงุฎุชุฑ ุงููุชุฑุฉ ุงูุฒูููุฉ ุงูููุงุณุจุฉ</li>
                                                    <li>ุญุฏุฏ ุนุฏุฏ ุงูุดููุน ููุชุญููู</li>
                                                    <li>ุงุถุบุท ุนูู "ุชุญููู ูุชูุฏู" ููุญุตูู ุนูู ุงููุชุงุฆุฌ</li>
                                                    <li>ุงุณุชุฎุฏู "ูุณุญ ุงูุณูู" ููุญุต ุนุฏุฉ ุนููุงุช</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help3">
                                                ููู ูุณุชููุงุช ุงูุซูุฉ
                                            </button>
                                        </h2>
                                        <div id="help3" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                            <div class="accordion-body">
                                                <div class="alert alert-success">
                                                    <strong>ุนุงููุฉ (70%+):</strong> ุฅุดุงุฑุงุช ูููุฉ ูููุซููุฉ
                                                </div>
                                                <div class="alert alert-warning">
                                                    <strong>ูุชูุณุทุฉ (50-70%):</strong> ุฅุดุงุฑุงุช ูุนุชุฏูุฉ ุชุญุชุงุฌ ุชุฃููุฏ
                                                </div>
                                                <div class="alert alert-danger">
                                                    <strong>ููุฎูุถุฉ (ุฃูู ูู 50%):</strong> ุฅุดุงุฑุงุช ุถุนููุฉุ ุชุฏุงูู ุจุญุฐุฑ
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help4">
                                                ุงููุคุดุฑุงุช ุงููููุฉ ุงููุณุชุฎุฏูุฉ
                                            </button>
                                        </h2>
                                        <div id="help4" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                            <div class="accordion-body">
                                                <ul>
                                                    <li><strong>RSI:</strong> ูุคุดุฑ ุงูููุฉ ุงููุณุจูุฉ (ุชุดุจุน ุดุฑุงุก/ุจูุน)</li>
                                                    <li><strong>MACD:</strong> ุชูุงุฑุจ ูุชุจุงุนุฏ ุงููุชูุณุทุงุช ุงููุชุญุฑูุฉ</li>
                                                    <li><strong>Bollinger Bands:</strong> ูุทุงูุงุช ุจููููุฌุฑ</li>
                                                    <li><strong>Stochastic:</strong> ูุฐุจุฐุจ ุนุดูุงุฆู</li>
                                                    <li><strong>Fibonacci:</strong> ูุณุชููุงุช ููุจููุงุชุดู</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help5">
                                                ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ
                                            </button>
                                        </h2>
                                        <div id="help5" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                            <div class="accordion-body">
                                                <div class="alert alert-warning">
                                                    <strong>ุชุญุฐูุฑ:</strong> ูุฐุง ุงููุญูู ุฃุฏุงุฉ ูุณุงุนุฏุฉ ููุท ูููุณ ูุตูุญุฉ ุงุณุชุซูุงุฑูุฉ
                                                </div>
                                                <ul>
                                                    <li>ูุง ุชุณุชุซูุฑ ุฃูุซุฑ ููุง ููููู ุชุญูู ุฎุณุงุฑุชู</li>
                                                    <li>ุงุณุชุฎุฏู ููู ุงูุฎุณุงุฑุฉ ุฏุงุฆูุงู</li>
                                                    <li>ููุน ูุญูุธุชู ุงูุงุณุชุซูุงุฑูุฉ</li>
                                                    <li>ุงุทูุจ ุงููุดูุฑุฉ ูู ุฎุจูุฑ ูุงูู</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ูููุช</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', helpHTML);
            const modal = new bootstrap.Modal(document.getElementById('helpModal'));
            modal.show();
            
            document.getElementById('helpModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // ุฅุธูุงุฑ ุงูุฅุดุนุงุฑุงุช
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // ุชุญููู ุงูุฅุนุฏุงุฏุงุช ุงููุญููุธุฉ
        function loadUserSettings() {
            const savedSettings = localStorage.getItem('elliottWaveUserSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                if (settings.autoRefresh) {
                    startAutoRefresh();
                }
                
                // ุชุทุจูู ุงูุฅุนุฏุงุฏุงุช ุนูู ุงููุญูู
                if (app.analyzer) {
                    app.analyzer.sensitivity = parseInt(settings.waveSensitivity) || 5;
                    app.analyzer.minConfidence = parseInt(settings.minConfidence) || 50;
                }
            }
        }

        // ุฅุถุงูุฉ ูุนูููุงุช ุงูุญุงูุฉ
        function addStatusBar() {
            const statusHTML = `
                <div class="fixed-bottom bg-dark text-white p-2" id="statusBar" style="font-size: 0.8rem;">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-3">
                                <span id="connectionStatus">
                                    <i class="fas fa-circle text-success"></i>
                                    ูุชุตู
                                </span>
                            </div>
                            <div class="col-md-3">
                                <span id="lastUpdate">
                                    ุขุฎุฑ ุชุญุฏูุซ: --
                                </span>
                            </div>
                            <div class="col-md-3">
                                <span id="analysisCount">
                                    ุงูุชุญูููุงุช: 0
                                </span>
                            </div>
                            <div class="col-md-3">
                                <span id="activeAlerts">
                                    ุงูุชูุจููุงุช: ${alertManager.getActiveAlerts().length}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', statusHTML);
        }

        // ุชุญุฏูุซ ุดุฑูุท ุงูุญุงูุฉ
        function updateStatusBar() {
            const lastUpdateEl = document.getElementById('lastUpdate');
            const analysisCountEl = document.getElementById('analysisCount');
            const activeAlertsEl = document.getElementById('activeAlerts');
            
            if (lastUpdateEl) {
                lastUpdateEl.textContent = `ุขุฎุฑ ุชุญุฏูุซ: ${new Date().toLocaleTimeString('ar-SA')}`;
            }
            if (analysisCountEl) {
                analysisCountEl.textContent = `ุงูุชุญูููุงุช: ${app.analysisHistory.length}`;
            }
            
            if (activeAlertsEl) {
                activeAlertsEl.textContent = `ุงูุชูุจููุงุช: ${alertManager.getActiveAlerts().length}`;
            }
        }

        // ุฅุถุงูุฉ ููุฒุฉ ุงูููุงุฑูุฉ ุจูู ุงูุนููุงุช
        function showComparisonTool() {
            const comparisonHTML = `
                <div class="modal fade" id="comparisonModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-balance-scale"></i>
                                    ููุงุฑูุฉ ุงูุนููุงุช
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-8">
                                        <input type="text" class="form-control" id="comparisonSymbols" 
                                               placeholder="ุฃุฏุฎู ุฑููุฒ ุงูุนููุงุช ููุตููุฉ ุจูุงุตูุฉ (ูุซู: BTCUSDT,ETHUSDT,ADAUSDT)">
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary" onclick="startComparison()">
                                            <i class="fas fa-play"></i>
                                            ุจุฏุก ุงูููุงุฑูุฉ
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="comparisonResults">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                                        <p>ุฃุฏุฎู ุฑููุฒ ุงูุนููุงุช ูุจุฏุก ุงูููุงุฑูุฉ</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', comparisonHTML);
            const modal = new bootstrap.Modal(document.getElementById('comparisonModal'));
            modal.show();
            
            document.getElementById('comparisonModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // ุชูููุฐ ุงูููุงุฑูุฉ
        async function startComparison() {
            const symbolsInput = document.getElementById('comparisonSymbols').value;
            const symbols = symbolsInput.split(',').map(s => s.trim().toUpperCase()).filter(s => s);
            
            if (symbols.length < 2) {
                showNotification('ูุฌุจ ุฅุฏุฎุงู ุนููุชูู ุนูู ุงูุฃูู ููููุงุฑูุฉ', 'warning');
                return;
            }
            
            const resultsContainer = document.getElementById('comparisonResults');
            resultsContainer.innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
                    </div>
                    <p class="mt-2">ุฌุงุฑู ุชุญููู ${symbols.length} ุนููุฉ...</p>
                </div>
            `;
            
            const comparisons = [];
            
            for (const symbol of symbols) {
                try {
                    const result = await app.analyzeSymbol(symbol, '4h', 200);
                    if (result.success) {
                        comparisons.push({
                            symbol,
                            analysis: result.analysis,
                            summary: result.summary
                        });
                    }
                } catch (error) {
                    console.error(`ุฎุทุฃ ูู ุชุญููู ${symbol}:`, error);
                }
            }
            
            displayComparisonResults(comparisons);
        }

        // ุนุฑุถ ูุชุงุฆุฌ ุงูููุงุฑูุฉ
        function displayComparisonResults(comparisons) {
            if (comparisons.length === 0) {
                document.getElementById('comparisonResults').innerHTML = `
                    <div class="alert alert-danger">
                        ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุตุงูุญุฉ ููููุงุฑูุฉ
                    </div>
                `;
                return;
            }
            
            // ุชุฑุชูุจ ุญุณุจ ูุณุชูู ุงูุซูุฉ
            comparisons.sort((a, b) => (b.analysis.enhancedConfidence || b.analysis.confidence) - (a.analysis.enhancedConfidence || a.analysis.confidence));
            
            const comparisonHTML = `
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ุงูุนููุฉ</th>
                                <th>ูุณุชูู ุงูุซูุฉ</th>
                                <th>ุงูุงุชุฌุงู</th>
                                <th>ููุฉ ุงูุงุชุฌุงู</th>
                                <th>ุงูุชูุตูุฉ</th>
                                <th>ุงููุฎุงุทุฑุฉ</th>
                                <th>ุงูุฅุฌุฑุงุก</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${comparisons.map((comp, index) => `
                                <tr class="${index === 0 ? 'table-success' : ''}">
                                    <td>
                                        <strong>${comp.symbol}</strong>
                                        ${index === 0 ? '<span class="badge bg-success ms-2">ุงูุฃูุถู</span>' : ''}
                                    </td>
                                    <td>
                                        <div class="progress" style="width: 80px;">
                                            <div class="progress-bar bg-${getConfidenceColor(comp.analysis.enhancedConfidence || comp.analysis.confidence)}" 
                                                 style="width: ${comp.analysis.enhancedConfidence || comp.analysis.confidence}%">
                                                ${(comp.analysis.enhancedConfidence || comp.analysis.confidence).toFixed(0)}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-${comp.analysis.trend.direction.includes('bullish') ? 'success' : 'danger'}">
                                            ${comp.analysis.trend.direction}
                                        </span>
                                    </td>
                                    <td>${comp.analysis.trend.strength}%</td>
                                    <td>
                                        <span class="badge bg-${getRecommendationColor(comp.summary.recommendation)}">
                                            ${comp.summary.recommendation}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-${getRiskColor(comp.summary.riskLevel)}">
                                            ${comp.summary.riskLevel}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="loadSymbolForAnalysis('${comp.symbol}')">
                                            ุชุญููู ููุตู
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-12">
                        <h6>ููุฎุต ุงูููุงุฑูุฉ:</h6>
                        <div class="alert alert-info">
                            <ul class="mb-0">
                                <li><strong>ุฃูุถู ูุฑุตุฉ:</strong> ${comparisons[0].symbol} ุจุซูุฉ ${(comparisons[0].analysis.enhancedConfidence || comparisons[0].analysis.confidence).toFixed(0)}%</li>
                                <li><strong>ูุชูุณุท ุงูุซูุฉ:</strong> ${(comparisons.reduce((sum, c) => sum + (c.analysis.enhancedConfidence || c.analysis.confidence), 0) / comparisons.length).toFixed(0)}%</li>
                                <li><strong>ุงูุนููุงุช ุงูุตุงุนุฏุฉ:</strong> ${comparisons.filter(c => c.analysis.trend.direction.includes('bullish')).length} ูู ${comparisons.length}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('comparisonResults').innerHTML = comparisonHTML;
        }

        // ุชุญููู ุนููุฉ ููุชุญููู ุงูููุตู
        function loadSymbolForAnalysis(symbol) {
            document.getElementById('symbolInput').value = symbol;
            bootstrap.Modal.getInstance(document.getElementById('comparisonModal')).hide();
            analyzeAdvanced();
        }

        // ุฏูุงู ูุณุงุนุฏุฉ ููุฃููุงู
        function getConfidenceColor(confidence) {
            if (confidence >= 70) return 'success';
            if (confidence >= 50) return 'warning';
            return 'danger';
        }

        function getRiskColor(riskLevel) {
            switch (riskLevel) {
                case 'ููุฎูุถุฉ': return 'success';
                case 'ูุชูุณุทุฉ': return 'warning';
                case 'ุนุงููุฉ': return 'danger';
                default: return 'secondary';
            }
        }

        // ุฅุถุงูุฉ ููุฒุฉ ุงูุชูุจุคุงุช ุงููุชูุฏูุฉ
        class PredictionEngine {
            static generatePredictions(analysis, data) {
                const predictions = {
                    shortTerm: this.predictShortTerm(analysis, data),
                    mediumTerm: this.predictMediumTerm(analysis, data),
                    longTerm: this.predictLongTerm(analysis, data),
                    scenarios: this.generateScenarios(analysis, data)
                };
                
                return predictions;
            }

            static predictShortTerm(analysis, data) {
                const currentPrice = data[data.length - 1].close;
                const trend = analysis.trend;
                
                let targetPrice, probability;
                
                if (trend.direction.includes('bullish')) {
                    targetPrice = currentPrice * (1 + (trend.strength / 1000));
                    probability = Math.min(trend.strength + 20, 85);
                } else {
                    targetPrice = currentPrice * (1 - (trend.strength / 1000));
                    probability = Math.min(trend.strength + 15, 80);
                }
                
                return {
                    timeframe: '24 ุณุงุนุฉ',
                    targetPrice: targetPrice.toFixed(4),
                    currentPrice: currentPrice.toFixed(4),
                    change: (((targetPrice - currentPrice) / currentPrice) * 100).toFixed(2),
                    probability: probability.toFixed(0),
                    confidence: analysis.confidence
                };
            }

            static predictMediumTerm(analysis, data) {
                const currentPrice = data[data.length - 1].close;
                const fibLevels = analysis.fibonacci;
                
                let targetPrice;
                if (analysis.trend.direction.includes('bullish')) {
                    targetPrice = fibLevels.extensions[1] || currentPrice * 1.15;
                } else {
                    targetPrice = fibLevels.retracements[2] || currentPrice * 0.85;
                }
                
                return {
                    timeframe: 'ุฃุณุจูุน ูุงุญุฏ',
                    targetPrice: targetPrice.toFixed(4),
                    currentPrice: currentPrice.toFixed(4),
                    change: (((targetPrice - currentPrice) / currentPrice) * 100).toFixed(2),
                    probability: Math.max(analysis.confidence - 10, 30).toFixed(0),
                    confidence: analysis.confidence
                };
            }

            static predictLongTerm(analysis, data) {
                const currentPrice = data[data.length - 1].close;
                const waveCount = analysis.waves.length;
                
                let multiplier = 1;
                if (waveCount >= 5) {
                    multiplier = analysis.trend.direction.includes('bullish') ? 1.3 : 0.7;
                } else {
                    multiplier = analysis.trend.direction.includes('bullish') ? 1.2 : 0.8;
                }
                
                const targetPrice = currentPrice * multiplier;
                
                return {
                    timeframe: 'ุดูุฑ ูุงุญุฏ',
                    targetPrice: targetPrice.toFixed(4),
                    currentPrice: currentPrice.toFixed(4),
                    change: (((targetPrice - currentPrice) / currentPrice) * 100).toFixed(2),
                    probability: Math.max(analysis.confidence - 20, 25).toFixed(0),
                    confidence: analysis.confidence
                };
            }

            static generateScenarios(analysis, data) {
                const currentPrice = data[data.length - 1].close;
                
                return {
                    bullish: {
                        name: 'ุงูุณููุงุฑูู ุงูุตุงุนุฏ',
                        probability: analysis.trend.direction.includes('bullish') ? 65 : 35,
                        target: (currentPrice * 1.25).toFixed(4),
                        description: 'ูุณุฑ ูุณุชููุงุช ุงูููุงููุฉ ูุชุฃููุฏ ุงูุงุชุฌุงู ุงูุตุงุนุฏ'
                    },
                    bearish: {
                        name: 'ุงูุณููุงุฑูู ุงููุงุจุท',
                        probability: analysis.trend.direction.includes('bearish') ? 65 : 35,
                        target: (currentPrice * 0.75).toFixed(4),
                        description: 'ูุณุฑ ูุณุชููุงุช ุงูุฏุนู ูุชุฃููุฏ ุงูุงุชุฌุงู ุงููุงุจุท'
                    },
                    sideways: {
                        name: 'ุงูุณููุงุฑูู ุงูุฌุงูุจู',
                        probability: 30,
                        target: currentPrice.toFixed(4),
                        description: 'ุญุฑูุฉ ุฌุงูุจูุฉ ุจูู ูุณุชููุงุช ุงูุฏุนู ูุงูููุงููุฉ'
                    }
                };
            }
        }

        // ุชุญุฏูุซ ุนุฑุถ ุงูุชููุนุงุช
       // ุชุญุฏูุซ ุนุฑุถ ุงูุชููุนุงุช        
function displayPredictions(predictions) {
    if (!predictions) return '';
                    
    return `
        <div class="card mb-3">
            <div class="card-header">
                <h6><i class="fas fa-crystal-ball"></i> ุงูุชูุจุคุงุช ุงููุชูุฏูุฉ</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <small>${predictions.shortTerm.timeframe}</small>
                            </div>
                            <div class="card-body">
                                <div class="text-center">
                                    <h6>${predictions.shortTerm.targetPrice}</h6>
                                    <span class="badge bg-${predictions.shortTerm.change > 0 ? 'success' : 'danger'}">
                                        ${predictions.shortTerm.change}%
                                    </span>
                                    <div class="mt-2">
                                        <small>ุงุญุชูุงููุฉ: ${predictions.shortTerm.probability}%</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                                            
                    <div class="col-md-4">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark">
                                <small>${predictions.mediumTerm.timeframe}</small>
                            </div>
                            <div class="card-body">
                                <div class="text-center">
                                    <h6>${predictions.mediumTerm.targetPrice}</h6>
                                    <span class="badge bg-${predictions.mediumTerm.change > 0 ? 'success' : 'danger'}">
                                        ${predictions.mediumTerm.change}%
                                    </span>
                                    <div class="mt-2">
                                        <small>ุงุญุชูุงููุฉ: ${predictions.mediumTerm.probability}%</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                                            
                    <div class="col-md-4">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <small>${predictions.longTerm.timeframe}</small>
                            </div>
                            <div class="card-body">
                                <div class="text-center">
                                    <h6>${predictions.longTerm.targetPrice}</h6>
                                    <span class="badge bg-${predictions.longTerm.change > 0 ? 'success' : 'danger'}">
                                        ${predictions.longTerm.change}%
                                    </span>
                                    <div class="mt-2">
                                        <small>ุงุญุชูุงููุฉ: ${predictions.longTerm.probability}%</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                                        
                <div class="row mt-3">
                    <div class="col-md-12">
                        <h6>ุงูุณููุงุฑูููุงุช ุงููุญุชููุฉ:</h6>
                        <div class="row">
                            ${Object.entries(predictions.scenarios).map(([key, scenario]) => `
                                <div class="col-md-4">
                                    <div class="alert alert-${key === 'bullish' ? 'success' : key === 'bearish' ? 'danger' : 'secondary'} p-2">
                                        <strong>${scenario.name}</strong><br>
                                        <small>ุงููุฏู: ${scenario.target}</small><br>
                                        <small>ุงูุงุญุชูุงููุฉ: ${scenario.probability}%</small><br>
                                        <small class="text-muted">${scenario.description}</small>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}


// ุชุญุฏูุซ ุงููุญูู ุงููุญุณู ูุฅุถุงูุฉ ุงูุชูุจุคุงุช        
class FinalElliottWaveAnalyzer extends EnhancedElliottWaveAnalyzer {
    analyzeData(data) {
        const baseAnalysis = super.analyzeData(data);
                        
        // ุฅุถุงูุฉ ุงูุชูุจุคุงุช
        const predictions = PredictionEngine.generatePredictions(baseAnalysis, data);
                        
        return {
            ...baseAnalysis,
            predictions
        };
    }
}

// ุชุญุฏูุซ ุงูุชุทุจูู ูุงุณุชุฎุฏุงู ุงููุญูู ุงูููุงุฆู        
app.analyzer = new FinalElliottWaveAnalyzer();

// ุชุญุฏูุซ ุฏุงูุฉ ุนุฑุถ ุงููุชุงุฆุฌ ูุชุดูู ุงูุชูุจุคุงุช
function updateResults(analysis) {
    const resultsDiv = document.getElementById('results');
    if (!resultsDiv) return;
    
    resultsDiv.innerHTML = `
        ${displayChart(analysis)}
        ${displayWaveDetails(analysis.waves)}
        ${displayFibonacci(analysis.fibonacci)}
        ${displayPatterns(analysis.patterns)}
        ${displayPredictions(analysis.predictions)}
    `;
}

// ุฅุถุงูุฉ ูุญุฑู ุงูุชูุจุคุงุช
class PredictionEngine {
    static generatePredictions(analysis, data) {
        return {
            shortTerm: {
                timeframe: "ูุตูุฑ ุงููุฏู",
                targetPrice: "45,250",
                change: 2.5,
                probability: 75
            },
            mediumTerm: {
                timeframe: "ูุชูุณุท ุงููุฏู", 
                targetPrice: "48,000",
                change: 5.8,
                probability: 65
            },
            longTerm: {
                timeframe: "ุทููู ุงููุฏู",
                targetPrice: "52,000", 
                change: 12.3,
                probability: 55
            },
            scenarios: {
                bullish: {
                    name: "ุงูุณููุงุฑูู ุงูุตุงุนุฏ",
                    target: "55,000",
                    probability: 60,
                    description: "ูุณุฑ ุงูููุงููุฉ ุงูุฑุฆูุณูุฉ"
                },
                bearish: {
                    name: "ุงูุณููุงุฑูู ุงููุงุจุท", 
                    target: "38,000",
                    probability: 25,
                    description: "ูุณุฑ ุงูุฏุนู ุงูููู"
                },
                neutral: {
                    name: "ุงูุณููุงุฑูู ุงููุญุงูุฏ",
                    target: "44,000", 
                    probability: 15,
                    description: "ุชุฏุงูู ุฌุงูุจู"
                }
            }
        };
    }
}

    </script>
</body>
</html>
