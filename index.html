<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø±Ø§Ø¯Ø§Ø± Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <div class="container">
    <h1><i class="fa-solid fa-wave-square"></i> Ø±Ø§Ø¯Ø§Ø± Ù…ÙˆØ¬Ø§Øª Ø¥Ù„ÙŠÙˆØª</h1>
    <p class="loading" id="loading">ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø£ÙˆÙ„ 100 Ø¹Ù…Ù„Ø©...</p>
    <div id="results" class="results"></div>
  </div>

  <script src="elliott-wave.js"></script>
  <script>
    async function fetchTopSymbols(limit = 100) {
      const res = await fetch('https://api.binance.com/api/v3/ticker/24hr');
      const data = await res.json();
      return data
        .filter(d => d.symbol.endsWith('USDT') && !d.symbol.includes('UP') && !d.symbol.includes('DOWN'))
        .slice(0, limit)
        .map(d => d.symbol);
    }

    async function fetchKlines(symbol, interval = '1h', limit = 120) {
      const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
      const res = await fetch(url);
      const data = await res.json();
      return data.map(k => [k[0], k[1], k[2], k[3], k[4], k[5]]);
    }

    async function analyzeSymbol(symbol) {
      try {
        const data = await fetchKlines(symbol);
        const analyzer = new ElliottWaveAnalyzer();
        const result = analyzer.analyze(data);
        if (result.status === 'success' && result.patterns.length > 0) {
          const top = result.patterns[0];
          if (top.confidence >= 80) {
            renderCard(symbol, top, result.trend, result.currentWaveAnalysis);
          }
        }
      } catch (e) {
        console.warn(`âŒ Ø®Ø·Ø£ ÙÙŠ ${symbol}:`, e.message);
      }
    }

    async function runRadar() {
      const symbols = await fetchTopSymbols(100);
      for (let i = 0; i < symbols.length; i++) {
        setTimeout(() => analyzeSymbol(symbols[i]), i * 500); // delay Ù„Ø¹Ø¯Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Binance
      }
      document.getElementById("loading").textContent = "âœ… ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";
    }

    function renderCard(symbol, pattern, trend, wave) {
      const container = document.getElementById("results");

      const trendIcon = trend.includes('bullish') ? 'fa-arrow-up' : 'fa-arrow-down';
      const waveText = wave?.currentWave ? translateWave(wave.currentWave) : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©';

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h2><i class="fa-solid fa-coins"></i> ${symbol}</h2>
        <p><i class="fa-solid fa-chart-line"></i> Ø§Ù„Ù†Ù…Ø·: ${pattern.type === 'motive' ? 'Ø¯Ø§ÙØ¹' : 'ØªØµØ­ÙŠØ­ÙŠ'} 
          ${pattern.direction === 'bullish' ? 'ğŸš€ ØµØ§Ø¹Ø¯' : 'ğŸ“‰ Ù‡Ø§Ø¨Ø·'}</p>
        <p><i class="fa-solid fa-shield-halved"></i> Ø§Ù„Ø«Ù‚Ø©: <strong>${pattern.confidence}%</strong></p>
        <p><i class="fa-solid fa-location-crosshairs"></i> Ø§Ù„Ù…ÙˆØ¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${waveText}</p>
        <p><i class="fa-solid ${trendIcon}"></i> Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ø§Ù…: ${translateTrend(trend)}</p>
      `;
      container.appendChild(card);
    }

    function translateWave(code) {
      const map = {
        'extension_or_new_cycle': 'Ø§Ù…ØªØ¯Ø§Ø¯ Ø£Ùˆ Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©',
        'corrective_phase': 'Ù…Ø±Ø­Ù„Ø© ØªØµØ­ÙŠØ­ÙŠØ©',
        'correction_completion': 'Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØµØ­ÙŠØ­',
        'new_impulse_starting': 'Ø¨Ø¯Ø§ÙŠØ© Ø¯ÙØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©'
      };
      return map[code] || code;
    }

    function translateTrend(trend) {
      const map = {
        bullish: 'ØµØ§Ø¹Ø¯',
        bearish: 'Ù‡Ø§Ø¨Ø·',
        neutral: 'Ù…Ø­Ø§ÙŠØ¯',
        bullish_correction_end: 'Ù†Ù‡Ø§ÙŠØ© ØªØµØ­ÙŠØ­ ØµØ§Ø¹Ø¯',
        bearish_correction_end: 'Ù†Ù‡Ø§ÙŠØ© ØªØµØ­ÙŠØ­ Ù‡Ø§Ø¨Ø·'
      };
      return map[trend] || trend;
    }

    runRadar();
  </script>

  <script src="elliott-wave.js"></script>
</body>

</html>
